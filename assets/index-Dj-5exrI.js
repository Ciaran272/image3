const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./aiUpscale-BFKUS1xm.js","./vendor-ai-Cjay71on.js","./vendor-other-B_-1jgMS.js"])))=>i.map(i=>d[i]);
var oe=Object.defineProperty;var de=(a,n,t)=>n in a?oe(a,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[n]=t;var W=(a,n,t)=>de(a,typeof n!="symbol"?n+"":n,t);import{j as e,r as y,T as ue,C as te,c as he,R as pe}from"./vendor-react-lLDS_VkD.js";import{i as ne}from"./vendor-other-B_-1jgMS.js";import{F as V,J as le,p as me}from"./vendor-utils-DXtK3xK1.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))s(c);new MutationObserver(c=>{for(const l of c)if(l.type==="childList")for(const h of l.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function t(c){const l={};return c.integrity&&(l.integrity=c.integrity),c.referrerPolicy&&(l.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?l.credentials="include":c.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(c){if(c.ep)return;c.ep=!0;const l=t(c);fetch(c.href,l)}})();const fe="modulepreload",ge=function(a,n){return new URL(a,n).href},ae={},re=function(n,t,s){let c=Promise.resolve();if(t&&t.length>0){const h=document.getElementsByTagName("link"),i=document.querySelector("meta[property=csp-nonce]"),d=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));c=Promise.allSettled(t.map(p=>{if(p=ge(p,s),p in ae)return;ae[p]=!0;const x=p.endsWith(".css"),j=x?'[rel="stylesheet"]':"";if(!!s)for(let N=h.length-1;N>=0;N--){const U=h[N];if(U.href===p&&(!x||U.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${p}"]${j}`))return;const v=document.createElement("link");if(v.rel=x?"stylesheet":fe,x||(v.as="script"),v.crossOrigin="",v.href=p,d&&v.setAttribute("nonce",d),document.head.appendChild(v),x)return new Promise((N,U)=>{v.addEventListener("load",N),v.addEventListener("error",()=>U(new Error(`Unable to preload CSS for ${p}`)))})}))}function l(h){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=h,window.dispatchEvent(i),!i.defaultPrevented)throw h}return c.then(h=>{for(const i of h||[])i.status==="rejected"&&l(i.reason);return n().catch(l)})};function xe(){return e.jsx("header",{className:"header",children:e.jsx("div",{className:"header-content",children:e.jsx("div",{className:"logo",children:e.jsxs("div",{className:"logo-text",children:[e.jsx("h1",{children:"Image Processor"}),e.jsx("p",{children:"é«˜æ¸…Â·ä¼˜åŒ–é”¯é½¿"})]})})})})}function je({onFilesSelected:a}){const[n,t]=y.useState(!1),s=y.useCallback(i=>{i.preventDefault(),t(!0)},[]),c=y.useCallback(i=>{i.preventDefault(),t(!1)},[]),l=y.useCallback(i=>{i.preventDefault(),t(!1);const d=Array.from(i.dataTransfer.files).filter(p=>p.type.startsWith("image/"));d.length>0&&a(d)},[a]),h=y.useCallback(i=>{const d=Array.from(i.target.files||[]);d.length>0&&a(d)},[a]);return e.jsx("div",{className:"upload-zone-container",children:e.jsxs("div",{className:`upload-zone ${n?"dragging":""}`,onDragOver:s,onDragLeave:c,onDrop:l,children:[e.jsx("div",{className:"upload-icon",children:e.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 80 80",fill:"none",children:[e.jsx("circle",{cx:"40",cy:"40",r:"38",stroke:"url(#uploadGradient)",strokeWidth:"2",strokeDasharray:"4 4"}),e.jsx("path",{d:"M40 25V55M40 25L30 35M40 25L50 35",stroke:"url(#uploadGradient)",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M25 50C25 50 25 60 30 60H50C55 60 55 50 55 50",stroke:"url(#uploadGradient)",strokeWidth:"3",strokeLinecap:"round"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"uploadGradient",x1:"0",y1:"0",x2:"80",y2:"80",children:[e.jsx("stop",{offset:"0%",stopColor:"#4A90E2"}),e.jsx("stop",{offset:"100%",stopColor:"#7DD3C0"})]})})]})}),e.jsx("h2",{children:"ä¸Šä¼ å›¾ç‰‡å¼€å§‹å¤„ç†"}),e.jsx("p",{className:"upload-description",children:"æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„ï¼Œæˆ–ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®é€‰æ‹©æ–‡ä»¶"}),e.jsxs("label",{className:"upload-button",children:[e.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:h,style:{display:"none"}}),e.jsx("span",{children:"é€‰æ‹©å›¾ç‰‡"})]}),e.jsxs("div",{className:"upload-tips",children:[e.jsxs("div",{className:"tip-item",children:[e.jsx("span",{className:"tip-icon",children:"âœ“"}),e.jsx("span",{children:"æ”¯æŒ JPGã€PNGã€WebP ç­‰æ ¼å¼"})]}),e.jsxs("div",{className:"tip-item",children:[e.jsx("span",{className:"tip-icon",children:"âœ“"}),e.jsx("span",{children:"æ”¯æŒæ‰¹é‡ä¸Šä¼ å¤„ç†"})]})]})]})})}function H({value:a,options:n,onChange:t,placeholder:s,className:c,disabled:l=!1,compact:h=!1}){var J;const i=y.useRef(null),d=y.useRef(null),p=y.useRef(null),[x,j]=y.useState(!1),[D,v]=y.useState(0),N=y.useMemo(()=>n.findIndex(w=>w.value===a),[n,a]);y.useEffect(()=>{N>=0&&v(N)},[N,x]);const U=N>=0?n[N]:void 0,m=y.useCallback(()=>{j(!1)},[]),f=y.useCallback(()=>{l||j(w=>!w)},[l]),k=y.useCallback(w=>{if(!x)return;const S=i.current;S&&!S.contains(w.target)&&m()},[x,m]),I=y.useCallback(w=>{x&&w.key==="Escape"&&(w.preventDefault(),m())},[x,m]);y.useEffect(()=>(document.addEventListener("mousedown",k),document.addEventListener("keydown",I),()=>{document.removeEventListener("mousedown",k),document.removeEventListener("keydown",I)}),[k,I]);const E=y.useCallback(w=>{t(w),m(),requestAnimationFrame(()=>{var S;(S=d.current)==null||S.focus()})},[m,t]),G=y.useCallback(w=>{if(w.value===a){m();return}E(w.value)},[E,m,a]),M=y.useCallback(w=>{const S=p.current;if(!S)return;const z=S.children[w];if(!z)return;const O=z.offsetTop,_=O+z.offsetHeight,$=S.scrollTop,Q=$+S.clientHeight;O<$?S.scrollTop=O:_>Q&&(S.scrollTop=_-S.clientHeight)},[]),T=y.useCallback(w=>{if(!l){if(w.key===" "||w.key==="Enter"){w.preventDefault(),f();return}if(w.key==="ArrowDown"){if(w.preventDefault(),!x){j(!0);return}v(S=>{const z=Math.min(n.length-1,S+1);return M(z),z})}if(w.key==="ArrowUp"){if(w.preventDefault(),!x){j(!0);return}v(S=>{const z=Math.max(0,S-1);return M(z),z})}if(w.key==="Home"&&(w.preventDefault(),x||j(!0),M(0),v(0)),w.key==="End"){w.preventDefault();const S=Math.max(0,n.length-1);x||j(!0),M(S),v(S)}if(w.key==="Tab"&&m(),(w.key==="Enter"||w.key===" ")&&x){w.preventDefault();const S=n[D];S&&E(S.value)}}},[l,f,x,n,D,E,m,M]),q=y.useCallback((w,S)=>{if(w.key==="Enter"||w.key===" "){w.preventDefault();const z=n[S];z&&E(z.value)}},[E,n]);return e.jsxs("div",{ref:i,className:ne("styled-select",c,{"styled-select--open":x,"styled-select--disabled":l,"styled-select--compact":h}),"data-selected-label":U?String(U.label):"",style:h?{minWidth:130}:void 0,children:[e.jsxs("button",{type:"button",ref:d,className:"styled-select-trigger",onClick:f,onKeyDown:T,disabled:l,"aria-haspopup":"listbox","aria-expanded":x,children:[e.jsx("span",{className:"styled-select-value",children:U?U.label:s??"è¯·é€‰æ‹©"}),e.jsx("span",{className:"styled-select-icon","aria-hidden":"true",children:e.jsx("svg",{width:"14",height:"10",viewBox:"0 0 14 10",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M1 3L7 9L13 3",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),e.jsx("ul",{ref:p,className:"styled-select-dropdown",role:"listbox",tabIndex:-1,"aria-activedescendant":D>=0?`styled-select-option-${String((J=n[D])==null?void 0:J.value)}`:void 0,hidden:!x,children:n.map((w,S)=>{const z=w.value===a,O=S===D;return e.jsxs("li",{id:`styled-select-option-${String(w.value)}`,role:"option","aria-selected":z,className:ne("styled-select-option",{"styled-select-option--selected":z,"styled-select-option--highlighted":O}),onMouseEnter:()=>v(S),onMouseDown:_=>_.preventDefault(),onClick:()=>G(w),onKeyDown:_=>q(_,S),tabIndex:-1,children:[e.jsx("span",{className:"styled-select-option-label",children:w.label}),w.description?e.jsx("span",{className:"styled-select-option-description",children:w.description}):null]},String(w.value))})})]})}const be=[{value:2,label:"2x"},{value:3,label:"3x"},{value:4,label:"4x"}],we=[{value:"none",label:"ä¸å˜"},{value:"light",label:"è½»åº¦å»å™ª"},{value:"medium",label:"ä¸­åº¦å»å™ª"},{value:"heavy",label:"é‡åº¦å»å™ª"}],ve=[{value:"svg",label:"SVG"},{value:"png",label:"PNG"},{value:"both",label:"ä¸¤ç§"}],Ne=[{value:"original",label:"ä¸å˜"},{value:72,label:"72DPI"},{value:150,label:"150DPI"},{value:300,label:"300DPI"},{value:600,label:"600DPI"}];function ye({options:a,onUpdateOptions:n,variant:t="default",className:s}){const c=["basic-settings-grid"];return t==="compact"&&c.push("basic-settings-grid--compact"),s&&c.push(s),e.jsxs("div",{className:c.join(" "),children:[e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"æ”¾å¤§å€æ•°"}),e.jsx(H,{value:a.upscaleFactor,options:be,onChange:l=>n({upscaleFactor:l}),compact:t==="compact"})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"å»å™ªå¼ºåº¦"}),e.jsx(H,{value:a.denoiseLevel,options:we,onChange:l=>n({denoiseLevel:l}),compact:t==="compact"})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"è¾“å‡ºæ ¼å¼"}),e.jsx(H,{value:a.outputFormat,options:ve,onChange:l=>n({outputFormat:l}),compact:t==="compact"})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"è¾“å‡º DPI"}),e.jsx(H,{value:a.dpi,options:Ne,onChange:l=>n({dpi:l}),compact:t==="compact"})]})]})}function ke({options:a,onUpdateOptions:n,variant:t="default",className:s,showReminders:c=!0}){const l=["processing-pipeline"];return t==="compact"&&l.push("processing-pipeline--compact"),s&&l.push(s),e.jsxs("div",{className:l.join(" "),children:[e.jsxs("div",{className:t==="compact"?"pipeline-pill-group":"pipeline-checkbox-group",children:[e.jsxs("label",{className:t==="compact"?"pipeline-pill":"pipeline-checkbox",children:[e.jsx("input",{type:"checkbox",checked:a.enableBasicEnhancement,onChange:h=>n({enableBasicEnhancement:h.target.checked})}),e.jsx("span",{children:"åŸºç¡€æ”¾å¤§å’Œå»å™ª"})]}),e.jsxs("label",{className:t==="compact"?"pipeline-pill":"pipeline-checkbox",children:[e.jsx("input",{type:"checkbox",checked:a.enableAIUpscale,onChange:h=>n({enableAIUpscale:h.target.checked})}),e.jsx("span",{children:"AI è¶…åˆ†è¾¨ç‡"})]}),e.jsxs("label",{className:t==="compact"?"pipeline-pill":"pipeline-checkbox",children:[e.jsx("input",{type:"checkbox",checked:a.enableVectorize,onChange:h=>n({enableVectorize:h.target.checked})}),e.jsx("span",{children:"ä½å›¾è½¬çŸ¢é‡"})]})]}),c?t==="compact"?e.jsxs("div",{className:"pipeline-reminders pipeline-reminders--compact",children:[a.enableAIUpscale?e.jsxs("div",{className:"pipeline-warning",children:[e.jsx("span",{className:"pipeline-warning__icon","aria-hidden":"true",children:"âš ï¸"}),e.jsx("span",{className:"pipeline-warning__text",children:"è€—æ—¶è¾ƒä¹…ï¼Œå ç”¨æ˜¾å­˜ï¼ˆæ˜¾å¡/æµè§ˆå™¨æ€§èƒ½ï¼‰"})]}):null,a.enableAIUpscale&&a.enableBasicEnhancement?e.jsxs("div",{className:"pipeline-hint",children:[e.jsx("span",{className:"pipeline-hint__icon","aria-hidden":"true",children:"ğŸ’¡"}),e.jsx("span",{className:"pipeline-hint__text",children:"AI è¶…åˆ†ä¼šç›´æ¥å¤„ç†åŸå›¾ä»¥é¿å…å†…å­˜è¶…é™"})]}):null]}):e.jsxs(e.Fragment,{children:[a.enableAIUpscale&&e.jsxs("div",{className:"pipeline-warning",children:[e.jsx("span",{className:"pipeline-warning__icon","aria-hidden":"true",children:"âš ï¸"}),e.jsx("span",{className:"pipeline-warning__text",children:"è€—æ—¶è¾ƒä¹…ï¼Œå ç”¨æ˜¾å­˜ï¼ˆæ˜¾å¡/æµè§ˆå™¨æ€§èƒ½ï¼‰"})]}),a.enableAIUpscale&&a.enableBasicEnhancement&&e.jsxs("div",{className:"pipeline-hint",children:[e.jsx("span",{className:"pipeline-hint__icon","aria-hidden":"true",children:"ğŸ’¡"}),e.jsx("span",{className:"pipeline-hint__text",children:"AI è¶…åˆ†ä¼šç›´æ¥å¤„ç†åŸå›¾ä»¥é¿å…å†…å­˜è¶…é™"})]})]}):null]})}function Ie({images:a,onRemoveImage:n,reminderContent:t}){return e.jsxs("div",{className:"image-gallery",children:[e.jsxs("div",{className:"gallery-header",children:[e.jsxs("div",{className:"gallery-title-block",children:[e.jsx("h3",{children:"ğŸï¸ å›¾ç‰‡åˆ—è¡¨"}),Array.isArray(t)?e.jsx(ue,{className:"inline-reminders",children:t}):t]}),e.jsxs("span",{className:"image-count",children:["å…± ",a.length," å¼ "]})]}),e.jsx("div",{className:"gallery-grid",children:a.map(s=>e.jsxs("div",{className:"gallery-item",children:[e.jsxs("div",{className:"gallery-preview",children:[e.jsx("img",{src:s.originalUrl,alt:s.file.name}),e.jsx("button",{className:"remove-btn",onClick:()=>n(s.id),title:"ç§»é™¤",children:"Ã—"})]}),e.jsxs("div",{className:"gallery-info",children:[e.jsx("h4",{className:"gallery-name",title:s.file.name,children:s.file.name}),e.jsxs("p",{className:"gallery-size",children:[(s.file.size/1024/1024).toFixed(2)," MB"]})]})]},s.id))})]})}function Ue({images:a,onUpdateOptions:n,onRemoveImage:t,onStartProcessing:s,onAddMore:c}){var v;const[l,h]=y.useState(((v=a[0])==null?void 0:v.options)||{upscaleFactor:2,denoiseLevel:"none",outputFormat:"both",dpi:"original",enableBasicEnhancement:!0,enableAIUpscale:!1,enableVectorize:!1,vectorizePrecision:"medium"}),i=N=>{const U=Array.from(N.target.files||[]);U.length>0&&c(U)},d=N=>{const U={...l,...N};h(U),a.forEach(m=>{n(m.id,N)})},p=l.enableAIUpscale,x=l.enableAIUpscale&&l.enableBasicEnhancement,j=[];p&&j.push(e.jsx(te,{classNames:"reminder-bubble",timeout:240,appear:!0,children:e.jsxs("div",{className:"pipeline-warning",children:[e.jsx("span",{className:"pipeline-warning__icon","aria-hidden":"true",children:"â—"}),e.jsx("span",{className:"pipeline-warning__text",children:"å ç”¨æ˜¾å­˜ï¼Œè€—æ—¶è¾ƒä¹…ï¼ˆéœ€è¦æ˜¾å¡/æµè§ˆå™¨æ€§èƒ½ï¼‰"})]})},"ai-warning")),x&&j.push(e.jsx(te,{classNames:"reminder-bubble",timeout:240,appear:!0,children:e.jsxs("div",{className:"pipeline-hint",children:[e.jsx("span",{className:"pipeline-hint__icon","aria-hidden":"true",children:"â›”"}),e.jsx("span",{className:"pipeline-hint__text",children:"è‹¥è¶…å‡ºé˜ˆå€¼ä¼šé™çº§å¤„ç†"})]})},"ai-hint"));const D=j.length>0?j:null;return y.useEffect(()=>{a.forEach(N=>{(N.options.upscaleFactor!==l.upscaleFactor||N.options.denoiseLevel!==l.denoiseLevel||N.options.outputFormat!==l.outputFormat||N.options.dpi!==l.dpi||N.options.enableBasicEnhancement!==l.enableBasicEnhancement||N.options.enableAIUpscale!==l.enableAIUpscale||N.options.enableVectorize!==l.enableVectorize||N.options.vectorizePrecision!==l.vectorizePrecision)&&n(N.id,{upscaleFactor:l.upscaleFactor,denoiseLevel:l.denoiseLevel,outputFormat:l.outputFormat,dpi:l.dpi,enableBasicEnhancement:l.enableBasicEnhancement,enableAIUpscale:l.enableAIUpscale,enableVectorize:l.enableVectorize,vectorizePrecision:l.vectorizePrecision})})},[a,l,n]),e.jsxs("div",{className:"image-list-container",children:[e.jsxs("div",{className:"list-header",children:[e.jsxs("div",{className:"header-settings-bar",children:[e.jsx(ye,{options:l,onUpdateOptions:d,variant:"compact"}),e.jsx(ke,{options:l,onUpdateOptions:d,variant:"compact",showReminders:!1})]}),e.jsxs("div",{className:"header-actions",children:[e.jsxs("label",{className:"add-more-button",children:[e.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:i,style:{display:"none"}}),e.jsx("span",{children:"â• æ·»åŠ æ›´å¤š"})]}),e.jsx("button",{className:"start-button",onClick:s,children:"â–¶ï¸ å¼€å§‹å¤„ç†"})]})]}),e.jsx("div",{className:"content-layout",children:e.jsx("div",{className:"image-gallery-wrapper",children:e.jsx(Ie,{images:a,onRemoveImage:t,reminderContent:D})})})]})}function Pe({images:a,stats:n,onComplete:t}){const s=Math.min(n.completed+n.failed,n.total),c=s>=n.total&&n.total>0,l=Math.min(n.currentIndex,a.length-1),h=!c&&l>=0&&l<a.length?a[l]:void 0,i=n.total>0?s/n.total*100:0,d=()=>{if(n.completed+n.failed>=n.total)return"å³å°†å®Œæˆ...";if(!n.startTime||n.completed===0)return"è®¡ç®—ä¸­...";const x=(Date.now()-n.startTime)/n.completed,j=(n.total-n.completed-n.failed)*x;if(j<=0)return"å³å°†å®Œæˆ...";const D=Math.floor(j/6e4),v=Math.floor(j%6e4/1e3);return D>0?`çº¦ ${D} åˆ† ${v} ç§’`:`çº¦ ${v} ç§’`};return e.jsxs("div",{className:"processing-panel",children:[e.jsxs("div",{className:"processing-header",children:[e.jsx("h2",{children:c?"å¤„ç†å·²å®Œæˆï¼":"æ­£åœ¨å¤„ç†å›¾ç‰‡..."}),e.jsx("p",{className:"processing-subtitle",children:c?"æ‰€æœ‰å›¾ç‰‡å¤„ç†å®Œæˆï¼Œå³å°†è·³è½¬åˆ°ç»“æœé¡µé¢...":""}),c&&e.jsx("button",{className:"view-results-button",type:"button",onClick:t,children:"ğŸ“Š æŸ¥çœ‹å¤„ç†ç»“æœ"})]}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsxs("div",{className:"stat-value",children:[s," / ",n.total]}),e.jsx("div",{className:"stat-label",children:"å½“å‰è¿›åº¦"})]}),e.jsxs("div",{className:"stat-card success",children:[e.jsx("div",{className:"stat-value",children:n.completed}),e.jsx("div",{className:"stat-label",children:"å·²å®Œæˆ"})]}),e.jsxs("div",{className:"stat-card error",children:[e.jsx("div",{className:"stat-value",children:n.failed}),e.jsx("div",{className:"stat-label",children:"å¤±è´¥/è·³è¿‡"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-value",children:d()}),e.jsx("div",{className:"stat-label",children:"é¢„è®¡å‰©ä½™"})]})]}),e.jsxs("div",{className:"progress-section",children:[e.jsxs("div",{className:"progress-header",children:[e.jsx("span",{children:"æ€»ä½“è¿›åº¦"}),e.jsxs("span",{className:"progress-percentage",children:[i.toFixed(0),"%"]})]}),e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${Math.max(0,Math.min(100,i))}%`}})})]}),h&&e.jsxs("div",{className:"current-image-section",children:[e.jsx("h3",{children:"å½“å‰å¤„ç†"}),e.jsxs("div",{className:"current-image-card",children:[e.jsx("div",{className:"current-image-preview",children:e.jsx("img",{src:h.originalUrl,alt:h.file.name})}),e.jsxs("div",{className:"current-image-info",children:[e.jsx("h4",{children:h.file.name}),e.jsx("div",{className:"processing-steps",children:e.jsxs("div",{className:"step active",children:[e.jsx("div",{className:"step-icon",children:e.jsx("div",{className:"spinner"})}),e.jsx("span",{children:"å¤„ç†ä¸­..."})]})})]})]})]}),e.jsxs("div",{className:"completed-list",children:[e.jsx("h3",{children:"å·²å¤„ç†åˆ—è¡¨"}),e.jsx("div",{className:"completed-items",children:a.filter(p=>p.status==="completed"||p.status==="failed").map(p=>{var x;return e.jsxs("div",{className:`completed-item ${p.status}`,children:[e.jsx("div",{className:"completed-icon",children:p.status==="completed"?"âœ“":"âœ—"}),e.jsx("span",{className:"completed-name",children:p.file.name}),e.jsx("span",{className:"completed-size-change",children:(()=>{var N;if(p.status!=="completed")return"--";const j=p.file.size/1024/1024,D=(N=p.result)==null?void 0:N.pngSize;if(!D)return`${j.toFixed(2)}MB`;const v=D/1024/1024;return`${j.toFixed(2)}MB â†’ ${v.toFixed(2)}MB`})()}),e.jsx("span",{className:"completed-status",children:p.status==="completed"?`${(((x=p.result)==null?void 0:x.processingTime)||0)/1e3}s`:p.error||"å¤±è´¥"})]},p.id)})})]})]})}function Ce({images:a,onBackToUpload:n,onBackToProcessing:t}){var K,X,Y,Z,ee,se;const[s,c]=y.useState(null),[l,h]=y.useState(!1),[i,d]=y.useState(new Set),[p,x]=y.useState(!1),[j,D]=y.useState(90),[v,N]=y.useState(new Map),[U,m]=y.useState(!1),f=a.filter(r=>r.status==="completed"),k=a.filter(r=>r.status==="failed").map(r=>({id:r.id,filename:r.file.name,reason:r.error||"æœªçŸ¥é”™è¯¯"})),I=f.filter(r=>{var g;return!!((g=r.result)!=null&&g.pngUrl)}),E=I.length>0,M=I.filter(r=>i.has(r.id)).length,T=async(r,g)=>{if(!r.result)return;const b=g==="svg"?r.result.svgUrl:r.result.pngUrl;if(!b)return;const u=await(await fetch(b)).blob(),P=g==="svg"?".svg":".png",C=r.file.name.replace(/\.[^/.]+$/,"")+`_processed${P}`;V.saveAs(u,C)},q=async()=>{const r=new le;for(const b of f){if(!b.result)continue;const o=b.file.name.replace(/\.[^/.]+$/,"");if(b.result.svgUrl){const P=await(await fetch(b.result.svgUrl)).blob();r.file(`${o}.svg`,P)}if(b.result.pngUrl){const P=await(await fetch(b.result.pngUrl)).blob();r.file(`${o}.png`,P)}}const g=await r.generateAsync({type:"blob"});V.saveAs(g,`processed_images_${Date.now()}.zip`)},J=r=>{d(g=>{const b=new Set(g);return b.has(r)?b.delete(r):b.add(r),b})},w=()=>{i.size===f.length?d(new Set):d(new Set(f.map(r=>r.id)))},S=async()=>{const r=I.filter(g=>i.has(g.id));if(r.length===0){alert("é€‰ä¸­çš„å›¾ç‰‡ä¸­æ²¡æœ‰å¯ç”¨çš„ PNG ç»“æœ");return}try{if("showDirectoryPicker"in window){const g=await window.showDirectoryPicker({mode:"readwrite"});for(const b of r){const u=await(await fetch(b.result.pngUrl)).blob(),P=b.file.name.replace(/\.[^/.]+$/,"")+"_processed.png",F=await(await g.getFileHandle(P,{create:!0})).createWritable();await F.write(u),await F.close()}alert(`æˆåŠŸä¸‹è½½ ${r.length} å¼  PNG å›¾ç‰‡ï¼`)}else{for(const g of r){const o=await(await fetch(g.result.pngUrl)).blob(),u=g.file.name.replace(/\.[^/.]+$/,"")+"_processed.png";V.saveAs(o,u),await new Promise(P=>setTimeout(P,300))}alert(`å·²è§¦å‘ ${r.length} ä¸ªä¸‹è½½ï¼Œè¯·åœ¨æµè§ˆå™¨ä¸‹è½½æ æŸ¥çœ‹`)}}catch(g){g.name!=="AbortError"&&(console.error("ä¸‹è½½å¤±è´¥:",g),alert("ä¸‹è½½å¤±è´¥ï¼Œè¯·é‡è¯•"))}},z=async r=>{try{const b=await(await fetch(r)).arrayBuffer(),o=new Uint8Array(b);if(o[0]!==137||o[1]!==80||o[2]!==78||o[3]!==71)return null;let u=8;for(;u<o.length-12;){const P=o[u]<<24|o[u+1]<<16|o[u+2]<<8|o[u+3],C=String.fromCharCode(o[u+4],o[u+5],o[u+6],o[u+7]);if(C==="pHYs"){const F=o[u+8]<<24|o[u+9]<<16|o[u+10]<<8|o[u+11];if(o[u+16]===1)return Math.round(F/39.3701)}if(C==="IEND")break;u+=12+P}return null}catch(g){return console.warn("è¯»å– PNG DPI å¤±è´¥:",g),null}},O=async(r,g,b)=>new Promise((o,u)=>{const P=new Image;P.crossOrigin="anonymous",P.onload=()=>{const C=document.createElement("canvas"),F=C.getContext("2d");if(!F){u(new Error("æ— æ³•åˆ›å»º Canvas ä¸Šä¸‹æ–‡"));return}C.width=P.width,C.height=P.height,F.fillStyle="#FFFFFF",F.fillRect(0,0,C.width,C.height),F.drawImage(P,0,0),C.toBlob(async R=>{if(R)try{if(b&&b>0){const A=await _(R,b);o({blob:A,size:A.size})}else o({blob:R,size:R.size})}catch(A){console.warn("æ·»åŠ  JPEG DPI å…ƒæ•°æ®å¤±è´¥ï¼Œä½¿ç”¨åŸå§‹å›¾ç‰‡",A),o({blob:R,size:R.size})}else u(new Error("è½¬æ¢å¤±è´¥"))},"image/jpeg",g/100)},P.onerror=()=>u(new Error("å›¾ç‰‡åŠ è½½å¤±è´¥")),P.src=r}),_=async(r,g)=>{const b=await r.arrayBuffer(),o=new Uint8Array(b);if(o[0]!==255||o[1]!==216)throw new Error("ä¸æ˜¯æœ‰æ•ˆçš„ JPEG æ–‡ä»¶");let u=2,P=!1,C=-1;for(;u<o.length-1;)if(o[u]===255){const A=o[u+1];if(A===224&&String.fromCharCode(o[u+4],o[u+5],o[u+6],o[u+7],o[u+8])==="JFIF\0"){P=!0,C=u;break}if(A>=208&&A<=217)u+=2;else if(A!==0&&A!==255){const L=o[u+2]<<8|o[u+3];u+=2+L}else u+=2}else u++;const R=(A=>{const L=new Uint8Array(18),B=new DataView(L.buffer);return B.setUint8(0,255),B.setUint8(1,224),B.setUint16(2,16,!1),L[4]=74,L[5]=70,L[6]=73,L[7]=70,L[8]=0,B.setUint8(9,1),B.setUint8(10,1),B.setUint8(11,1),B.setUint16(12,A,!1),B.setUint16(14,A,!1),B.setUint8(16,0),B.setUint8(17,0),L})(g);if(P&&C>=0){const A=o[C+2]<<8|o[C+3],L=new Uint8Array(o.length-A-2+R.length);return L.set(o.slice(0,C),0),L.set(R,C),L.set(o.slice(C+2+A),C+R.length),new Blob([L],{type:"image/jpeg"})}else{const A=new Uint8Array(o.length+R.length);return A.set(o.slice(0,2),0),A.set(R,2),A.set(o.slice(2),2+R.length),new Blob([A],{type:"image/jpeg"})}},$=async r=>{const g=f.filter(o=>{var u;return i.has(o.id)&&((u=o.result)==null?void 0:u.pngUrl)}),b=new Map;for(const o of g)try{let u;o.options.dpi==="original"?u=await z(o.result.pngUrl)||void 0:u=Number(o.options.dpi);const{size:P}=await O(o.result.pngUrl,r,u);b.set(o.id,P)}catch(u){console.error(`é¢„è§ˆå¤±è´¥: ${o.file.name}`,u)}N(b)};y.useEffect(()=>{if(!p)return;const r=setTimeout(()=>{$(j)},300);return()=>clearTimeout(r)},[j,p,i]);const Q=async()=>{const r=f.filter(g=>{var b;return i.has(g.id)&&((b=g.result)==null?void 0:b.pngUrl)});if(r.length===0){alert("è¯·å…ˆå‹¾é€‰è¦è½¬æ¢çš„å›¾ç‰‡");return}m(!0);try{if(r.length===1){const g=r[0];let b;g.options.dpi==="original"?b=await z(g.result.pngUrl)||void 0:b=Number(g.options.dpi);const{blob:o}=await O(g.result.pngUrl,j,b),u=g.file.name.replace(/\.[^/.]+$/,"")+".jpg";V.saveAs(o,u),alert("è½¬æ¢å®Œæˆï¼")}else{const g=new le;for(const o of r){let u;o.options.dpi==="original"?u=await z(o.result.pngUrl)||void 0:u=Number(o.options.dpi);const{blob:P}=await O(o.result.pngUrl,j,u),C=o.file.name.replace(/\.[^/.]+$/,"")+".jpg";g.file(C,P)}const b=await g.generateAsync({type:"blob"});V.saveAs(b,`jpeg_images_q${j}_${Date.now()}.zip`),alert(`æˆåŠŸè½¬æ¢å¹¶æ‰“åŒ… ${r.length} å¼  JPEG å›¾ç‰‡ï¼`)}x(!1)}catch(g){console.error("è½¬æ¢å¤±è´¥:",g),alert("è½¬æ¢å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{m(!1)}};return e.jsxs("div",{className:"results-view",children:[e.jsx("div",{className:"results-header",children:e.jsxs("div",{className:"results-header-actions",children:[e.jsx("button",{className:"select-all-button",onClick:w,children:i.size===f.length?"å–æ¶ˆå…¨é€‰":"å…¨é€‰æˆåŠŸå›¾ç‰‡"}),E&&e.jsxs("button",{className:"download-png-button",onClick:S,disabled:M===0,children:["ğŸ“¥ ä¸‹è½½é€‰ä¸­ PNG (",M,")"]}),E&&e.jsxs("button",{className:"convert-jpeg-button",onClick:()=>{if(M===0){alert("è¯·å…ˆå‹¾é€‰åŒ…å« PNG ç»“æœçš„å›¾ç‰‡");return}x(!0),$(j)},disabled:M===0,children:["ğŸ¨ è½¬æ¢ä¸º JPEG (",M,")"]}),t&&e.jsx("button",{className:"back-to-processing-button",onClick:t,children:"ğŸ” æŸ¥çœ‹å¤„ç†è¯¦æƒ…"}),e.jsx("button",{className:"download-all-button",onClick:q,children:"ğŸ“¦ ä¸‹è½½å…¨éƒ¨ç»“æœ"}),e.jsx("button",{className:"back-button",onClick:n,children:"â† è¿”å›ä¸Šä¼ é¡µ"})]})}),k.length>0&&e.jsxs("div",{className:"failed-section",children:[e.jsx("h3",{children:"å¤„ç†å¤±è´¥"}),e.jsx("div",{className:"failed-list",children:k.map(r=>e.jsxs("div",{className:"failed-item",children:[e.jsx("span",{className:"failed-icon",children:"âœ—"}),e.jsx("span",{className:"failed-name",children:r.filename}),e.jsx("span",{className:"failed-reason",children:r.reason})]},r.id))})]}),e.jsx("div",{className:"results-grid",children:f.map(r=>{var g,b,o,u,P;return e.jsxs("div",{className:`result-card ${i.has(r.id)?"checked":""}`,onClick:()=>c(r),children:[e.jsxs("div",{className:"result-preview",children:[e.jsx("div",{className:"checkbox-container",onClick:C=>{C.stopPropagation(),J(r.id)},children:e.jsx("input",{type:"checkbox",checked:i.has(r.id),onChange:()=>{},className:"image-checkbox"})}),e.jsx("img",{src:((g=r.result)==null?void 0:g.pngUrl)||((b=r.result)==null?void 0:b.svgUrl)||r.originalUrl,alt:r.file.name}),e.jsx("div",{className:"result-overlay",children:e.jsx("button",{className:"view-button",children:"ğŸ” æŸ¥çœ‹è¯¦æƒ…"})})]}),e.jsxs("div",{className:"result-info",children:[e.jsx("h4",{children:r.file.name}),e.jsxs("p",{children:["å¤„ç†æ—¶é—´: ",((((o=r.result)==null?void 0:o.processingTime)||0)/1e3).toFixed(1),"s",(()=>{var R;const C=r.file.size/1024/1024,F=(R=r.result)==null?void 0:R.pngSize;if(F!=null){const A=F/1024/1024;return` | å¤§å°: ${C.toFixed(2)}MB â†’ ${A.toFixed(2)}MB`}return""})()]}),e.jsxs("div",{className:"download-buttons",children:[((u=r.result)==null?void 0:u.svgUrl)&&e.jsx("button",{className:"mini-download-btn svg",onClick:C=>{C.stopPropagation(),T(r,"svg")},children:"SVG"}),((P=r.result)==null?void 0:P.pngUrl)&&e.jsx("button",{className:"mini-download-btn png",onClick:C=>{C.stopPropagation(),T(r,"png")},children:"PNG"})]})]})]},r.id)})}),s&&e.jsx("div",{className:"modal-overlay",onClick:()=>c(null),children:e.jsxs("div",{className:"modal-content",onClick:r=>r.stopPropagation(),children:[e.jsx("button",{className:"modal-close",onClick:()=>c(null),children:"Ã—"}),e.jsx("h3",{children:s.file.name}),e.jsxs("div",{className:"compare-toggle",children:[e.jsx("button",{className:l?"":"active",onClick:()=>h(!1),children:"å¤„ç†å"}),e.jsx("button",{className:l?"active":"",onClick:()=>h(!0),children:"å¯¹æ¯”æŸ¥çœ‹"})]}),l?e.jsxs("div",{className:"compare-view",children:[e.jsxs("div",{className:"compare-item",children:[e.jsx("h4",{children:"åŸå›¾"}),e.jsx("img",{src:s.originalUrl,alt:"åŸå›¾"})]}),e.jsx("div",{className:"compare-divider",children:"â†’"}),e.jsxs("div",{className:"compare-item",children:[e.jsx("h4",{children:"å¤„ç†å"}),e.jsx("img",{src:((Y=s.result)==null?void 0:Y.pngUrl)||((Z=s.result)==null?void 0:Z.svgUrl)||s.originalUrl,alt:"å¤„ç†å"})]})]}):e.jsx("div",{className:"single-view",children:e.jsx("img",{src:((K=s.result)==null?void 0:K.pngUrl)||((X=s.result)==null?void 0:X.svgUrl)||s.originalUrl,alt:"å¤„ç†å"})}),e.jsxs("div",{className:"modal-actions",children:[((ee=s.result)==null?void 0:ee.svgUrl)&&e.jsx("button",{className:"modal-download-btn",onClick:()=>T(s,"svg"),children:"ä¸‹è½½ SVG"}),((se=s.result)==null?void 0:se.pngUrl)&&e.jsx("button",{className:"modal-download-btn",onClick:()=>T(s,"png"),children:"ä¸‹è½½ PNG"})]})]})}),p&&e.jsx("div",{className:"jpeg-modal-overlay",onClick:()=>x(!1),children:e.jsxs("div",{className:"jpeg-modal",onClick:r=>r.stopPropagation(),children:[e.jsx("button",{className:"modal-close",onClick:()=>x(!1),children:"Ã—"}),e.jsx("h3",{children:"ğŸ¨ JPEG è½¬æ¢"}),e.jsxs("p",{className:"modal-info",children:["å·²é€‰ä¸­ ",e.jsx("strong",{children:i.size})," å¼ å›¾ç‰‡"]}),e.jsxs("div",{className:"quality-control",children:[e.jsxs("label",{children:[e.jsx("span",{children:"è´¨é‡:"}),e.jsxs("span",{className:"quality-value",children:[j,"%"]})]}),e.jsx("input",{type:"range",min:"50",max:"100",step:"5",value:j,onChange:r=>D(Number(r.target.value)),className:"quality-slider"}),e.jsxs("div",{className:"quality-marks",children:[e.jsx("span",{children:"50%"}),e.jsx("span",{children:"75%"}),e.jsx("span",{children:"100%"})]})]}),e.jsxs("div",{className:"preview-sizes",children:[e.jsx("h4",{children:"é¢„è®¡æ–‡ä»¶å¤§å°:"}),e.jsx("div",{className:"size-list",children:f.filter(r=>i.has(r.id)).map(r=>{var u;const g=((u=r.result)==null?void 0:u.pngSize)||r.file.size,b=v.get(r.id),o=b?Math.round((1-b/g)*100):0;return e.jsxs("div",{className:"size-item",children:[e.jsx("span",{className:"filename",children:r.file.name}),e.jsxs("span",{className:"size-change",children:[(g/1024/1024).toFixed(2),"MB"," â†’ ",b?`${(b/1024/1024).toFixed(2)}MB`:"è®¡ç®—ä¸­...",b&&e.jsxs("span",{className:"compression",children:[" (â†“",o,"%)"]})]})]},r.id)})}),e.jsxs("div",{className:"total-size",children:[e.jsx("strong",{children:"æ€»å¤§å°:"}),(()=>{const r=f.filter(o=>i.has(o.id)).reduce((o,u)=>{var P;return o+(((P=u.result)==null?void 0:P.pngSize)||u.file.size)},0),g=Array.from(v.values()).reduce((o,u)=>o+u,0),b=g>0?Math.round((1-g/r)*100):0;return e.jsxs(e.Fragment,{children:[" ",(r/1024/1024).toFixed(1),"MB"," â†’ ",v.size>0?`${(g/1024/1024).toFixed(1)}MB`:"è®¡ç®—ä¸­...",v.size>0&&e.jsxs("span",{className:"compression",children:[" (èŠ‚çœ ",b,"%)"]})]})})()]})]}),e.jsx("div",{className:"modal-actions",children:e.jsx("button",{className:"confirm-button",onClick:Q,disabled:U||v.size===0,children:U?"è½¬æ¢ä¸­...":"å¼€å§‹è½¬æ¢å¹¶ä¸‹è½½"})})]})})]})}const Se=async()=>await re(()=>import("./aiUpscale-BFKUS1xm.js"),__vite__mapDeps([0,1,2]),import.meta.url);async function Ee(a,n){const t=Date.now();try{return n(10),console.log("=== å¼€å§‹å¤„ç†å›¾ç‰‡ ==="),console.log("å¤„ç†æµç¨‹:",{åŸºç¡€å¢å¼º:a.options.enableBasicEnhancement,AIè¶…åˆ†:a.options.enableAIUpscale,çŸ¢é‡åŒ–:a.options.enableVectorize}),await De(a,n,t)}catch(s){throw console.error("å›¾ç‰‡å¤„ç†å¤±è´¥:",s),s}}async function De(a,n,t){let s=20,c,l,h=a.file,i,d;const p=a.options.outputFormat==="png"||a.options.outputFormat==="both",x=a.options.outputFormat==="svg"||a.options.outputFormat==="both",j=a.options.enableBasicEnhancement,D=a.options.enableAIUpscale,v=a.options.enableVectorize&&x;x&&!v&&console.warn("å·²é€‰æ‹© SVG è¾“å‡ºä½†æœªå¯ç”¨çŸ¢é‡åŒ–ï¼Œå°†ä¸ä¼šç”Ÿæˆ SVG ç»“æœ");const N=[j,D,v].filter(Boolean).length,U=N>0?70/N:0;if(j){console.log("æ‰§è¡Œæ­¥éª¤ 1: åŸºç¡€æ”¾å¤§å’Œå»å™ª");const m=await ie(h,a.options);i=m.url,l=m.url,d=m.size;try{const k=await(await fetch(i)).blob();h=new File([k],a.file.name,{type:"image/png"})}catch(f){console.warn("æ— æ³•è½¬æ¢ä¸­é—´ç»“æœï¼Œåç»­æ­¥éª¤å°†ä½¿ç”¨åŸå›¾",f)}s+=U,n(s)}if(D){console.log("æ‰§è¡Œæ­¥éª¤ 2: AI è¶…åˆ†è¾¨ç‡ï¼ˆåŸºäºå½“å‰ç»“æœï¼‰");try{const{aiUpscale:m,base64ToBlobUrl:f}=await Se(),k=await m(h,a.options.upscaleFactor,I=>n(s+I*(U/100)));i=k.startsWith("data:")?f(k):k,l=i;try{const E=await(await fetch(i)).blob();d=E.size,h=new File([E],a.file.name,{type:"image/png"}),console.log("âœ… AI è¶…åˆ†ç»“æœå·²è½¬æ¢ï¼Œä¾›åç»­æ­¥éª¤ä½¿ç”¨")}catch(I){console.warn("æ— æ³•è½¬æ¢AIè¶…åˆ†ç»“æœï¼Œåç»­æ­¥éª¤å°†ä½¿ç”¨åŸå›¾",I)}s+=U}catch(m){throw console.warn("AI è¶…åˆ†å¤±è´¥ï¼Œç»ˆæ­¢æ­¤å›¾ç‰‡å¤„ç†",m),m}n(s)}if(v){console.log("æ‰§è¡Œæ­¥éª¤ 3: ä½å›¾è½¬çŸ¢é‡ï¼ˆåŸºäºå½“å‰ç»“æœï¼‰");try{c=await Fe(h,a.options),s+=U}catch(m){console.warn("çŸ¢é‡åŒ–å¤±è´¥ï¼Œè·³è¿‡æ­¤æ­¥éª¤",m),s+=U}n(s)}if(!N&&p){console.log("æœªå¯ç”¨ä»»ä½•å¤„ç†ï¼Œä½¿ç”¨åŸºç¡€å¢å¼ºä½œä¸ºé»˜è®¤");const m=await ie(a.file,a.options);l=m.url,d=m.size}if(!l&&p){console.warn("æ‰€æœ‰å¤„ç†éƒ½å¤±è´¥ï¼Œæ— æ³•ç”Ÿæˆæ”¾å¤§ç»“æœ");const m=new Error("AI è¶…åˆ†å¤±è´¥ï¼Œæœªç”Ÿæˆæ–°çš„æ”¾å¤§å›¾åƒ");throw m.skipImage=!0,m}if(l&&p&&a.options.dpi!=="original"&&typeof a.options.dpi=="number")try{console.log(`æ­£åœ¨ä¸ºæœ€ç»ˆPNGæ·»åŠ  ${a.options.dpi} DPI å…ƒæ•°æ®...`);const f=await(await fetch(l)).blob(),k=await ce(f,a.options.dpi);URL.revokeObjectURL(l),l=URL.createObjectURL(k),d=k.size,console.log("âœ… DPI å…ƒæ•°æ®æ·»åŠ æˆåŠŸ")}catch(m){console.warn("æ·»åŠ  DPI å…ƒæ•°æ®å¤±è´¥ï¼Œä½¿ç”¨åŸå§‹å›¾ç‰‡",m)}if(n(100),console.log("å¤„ç†å®Œæˆï¼Œè¾“å‡º:",{hasSVG:!!c,hasPNG:!!l,processingTime:Date.now()-t}),!x&&c){try{URL.revokeObjectURL(c)}catch(m){console.warn("é‡Šæ”¾ SVG URL å¤±è´¥",m)}c=void 0}if(!p&&l){try{URL.revokeObjectURL(l)}catch(m){console.warn("é‡Šæ”¾ PNG URL å¤±è´¥",m)}l=void 0,d=void 0}if(!c&&!l){const m=new Error("æœªç”Ÿæˆå¯ç”¨çš„è¾“å‡ºç»“æœï¼Œè¯·æ£€æŸ¥è®¾ç½®");throw m.skipImage=!0,m}return{svgUrl:c,pngUrl:l,pngSize:d,processingTime:Date.now()-t}}async function Ae(a){try{const n=await a.arrayBuffer(),t=new Uint8Array(n);if(t[0]===137&&t[1]===80&&t[2]===78&&t[3]===71){let s=8;for(;s<t.length-12;){const c=t[s]<<24|t[s+1]<<16|t[s+2]<<8|t[s+3],l=String.fromCharCode(t[s+4],t[s+5],t[s+6],t[s+7]);if(l==="pHYs"){const h=t[s+8]<<24|t[s+9]<<16|t[s+10]<<8|t[s+11];if(t[s+16]===1){const d=Math.round(h/39.3701);return console.log(`ä» PNG è¯»å–åˆ° DPI: ${d}`),d}}if(l==="IEND")break;s+=12+c}}else if(t[0]===255&&t[1]===216){let s=2;for(;s<t.length-1;){if(t[s]===255&&t[s+1]===224){if(String.fromCharCode(t[s+4],t[s+5],t[s+6],t[s+7],t[s+8])==="JFIF\0"&&t[s+11]===1){const h=t[s+12]<<8|t[s+13];return console.log(`ä» JPEG è¯»å–åˆ° DPI: ${h}`),h}break}s++}}return null}catch(n){return console.warn("è¯»å–å›¾ç‰‡ DPI å¤±è´¥:",n),null}}async function ie(a,n){return new Promise(async(t,s)=>{const c=new Image,l=new FileReader;let h=null;n.dpi==="original"&&(h=await Ae(a),console.log(`åŸå§‹æ–‡ä»¶ DPI: ${h||"æœªæ‰¾åˆ°"}`)),l.onload=i=>{var d;c.src=(d=i.target)==null?void 0:d.result},c.onload=async()=>{const i=document.createElement("canvas"),d=i.getContext("2d");if(!d){s(new Error("æ— æ³•åˆ›å»º Canvas ä¸Šä¸‹æ–‡"));return}const p=n.upscaleFactor,x=n.dpi==="original"?h||0:Number(n.dpi);i.width=Math.round(c.width*p),i.height=Math.round(c.height*p),d.imageSmoothingEnabled=!0,d.imageSmoothingQuality="high",d.drawImage(c,0,0,i.width,i.height);const j=d.getImageData(0,0,i.width,i.height),D=Le(j,n.denoiseLevel);d.putImageData(D,0,0),i.toBlob(async v=>{if(v)try{if(x===0)t({url:URL.createObjectURL(v),size:v.size});else{const N=await ce(v,x);t({url:URL.createObjectURL(N),size:N.size})}}catch(N){console.warn("æ·»åŠ  DPI å…ƒæ•°æ®å¤±è´¥ï¼Œä½¿ç”¨åŸå§‹å›¾ç‰‡",N),t({url:URL.createObjectURL(v),size:v.size})}else s(new Error("æ— æ³•ç”Ÿæˆå›¾ç‰‡"))},"image/png",.95)},c.onerror=()=>s(new Error("å›¾ç‰‡åŠ è½½å¤±è´¥")),l.readAsDataURL(a)})}async function ce(a,n){const t=await a.arrayBuffer(),s=new Uint8Array(t),c=[137,80,78,71,13,10,26,10];for(let p=0;p<c.length;p++)if(s[p]!==c[p])throw new Error("ä¸æ˜¯æœ‰æ•ˆçš„ PNG æ–‡ä»¶");const l=33,h=Math.round(n*39.3701),i=ze(h,h),d=new Uint8Array(s.length+i.length);return d.set(s.slice(0,l),0),d.set(i,l),d.set(s.slice(l),l+i.length),new Blob([d],{type:"image/png"})}function ze(a,n){const t=new Uint8Array(21),s=new DataView(t.buffer);s.setUint32(0,9,!1),t[4]=112,t[5]=72,t[6]=89,t[7]=115,s.setUint32(8,a,!1),s.setUint32(12,n,!1),t[16]=1;const c=Re(t.slice(4,17));return s.setUint32(17,c,!1),t}function Re(a){let n=4294967295;for(let t=0;t<a.length;t++){n^=a[t];for(let s=0;s<8;s++)n=n>>>1^3988292384&-(n&1)}return(n^4294967295)>>>0}function Le(a,n){const t=a.data,s=a.width,c=a.height;if(n==="none")return a;const l=n==="light"?1.15:n==="medium"?1.25:1.35,h=n==="light"?.3:n==="medium"?.5:.7,i=new Uint8ClampedArray(t.length);for(let d=0;d<t.length;d+=4){let p=t[d],x=t[d+1],j=t[d+2];p=Math.min(255,Math.max(0,(p-128)*l+128)),x=Math.min(255,Math.max(0,(x-128)*l+128)),j=Math.min(255,Math.max(0,(j-128)*l+128)),i[d]=p,i[d+1]=x,i[d+2]=j,i[d+3]=t[d+3]}for(let d=1;d<c-1;d++)for(let p=1;p<s-1;p++){const x=(d*s+p)*4;for(let j=0;j<3;j++){const D=i[x+j],v=i[((d-1)*s+p)*4+j]+i[((d+1)*s+p)*4+j]+i[(d*s+p-1)*4+j]+i[(d*s+p+1)*4+j],N=D+h*(D*4-v);t[x+j]=Math.min(255,Math.max(0,N))}}return a}async function Fe(a,n){return new Promise((t,s)=>{const c=new Image,l=new FileReader;l.onload=h=>{var i;c.src=(i=h.target)==null?void 0:i.result},c.onload=()=>{const h=document.createElement("canvas"),i=h.getContext("2d");if(!i){s(new Error("æ— æ³•åˆ›å»º Canvas ä¸Šä¸‹æ–‡"));return}h.width=c.width,h.height=c.height,i.drawImage(c,0,0);const d=i.getImageData(0,0,h.width,h.height),p=n.vectorizePrecision==="high"?128:n.vectorizePrecision==="medium"?150:180;me.trace(d,{threshold:p},(x,j)=>{if(x){s(x);return}const D=new Blob([j],{type:"image/svg+xml"});t(URL.createObjectURL(D))})},c.onerror=()=>s(new Error("å›¾ç‰‡åŠ è½½å¤±è´¥")),l.readAsDataURL(a)})}class Me{constructor(n){W(this,"queue",[]);W(this,"isProcessing",!1);W(this,"shouldStop",!1);this.callbacks=n}addImages(n){this.queue=[...n]}async start(){var n,t;if(this.isProcessing){console.warn("é˜Ÿåˆ—æ­£åœ¨å¤„ç†ä¸­");return}this.isProcessing=!0,this.shouldStop=!1;for(let s=0;s<this.queue.length&&!this.shouldStop;s++){const c=this.queue[s];try{this.callbacks.onImageStart(c.id);const l=await Ee(c,h=>{this.callbacks.onImageProgress(c.id,h)});this.callbacks.onImageComplete(c.id,l)}catch(l){const h=l instanceof Error?l.message:"æœªçŸ¥é”™è¯¯";console.error(`å¤„ç†å›¾ç‰‡ ${c.file.name} å¤±è´¥:`,l);const i=!!(l!=null&&l.userAborted),d=!!(l!=null&&l.skipImage);if(this.callbacks.onImageError(c.id,h,{userAborted:i,skip:d}),i){this.shouldStop=!0;break}}await new Promise(l=>setTimeout(l,100))}this.isProcessing=!1,this.shouldStop?(t=(n=this.callbacks).onQueueAborted)==null||t.call(n):this.callbacks.onQueueComplete()}stop(){this.shouldStop=!0,this.isProcessing=!1}}function Be(){const[a,n]=y.useState("upload"),[t,s]=y.useState([]),[c,l]=y.useState({total:0,completed:0,failed:0,currentIndex:0}),h=y.useRef(null),i=y.useCallback(async()=>{var U,m;if(h.current)try{(m=(U=h.current).stop)==null||m.call(U)}catch(f){console.warn("åœæ­¢å¤„ç†é˜Ÿåˆ—å¤±è´¥",f)}t.forEach(f=>{var k,I;URL.revokeObjectURL(f.originalUrl),(k=f.result)!=null&&k.svgUrl&&URL.revokeObjectURL(f.result.svgUrl),(I=f.result)!=null&&I.pngUrl&&URL.revokeObjectURL(f.result.pngUrl)}),s([]),l({total:0,completed:0,failed:0,currentIndex:0}),n("upload");try{const{resetAIBackend:f}=await re(async()=>{const{resetAIBackend:k}=await import("./aiUpscale-BFKUS1xm.js");return{resetAIBackend:k}},__vite__mapDeps([0,1,2]),import.meta.url);await f()}catch(f){console.warn("é‡ç½® AI åç«¯å¤±è´¥",f)}typeof window<"u"&&(window.location.href=window.location.href.replace(/#.*$/,""))},[t]),d=y.useCallback(U=>{const m={upscaleFactor:2,denoiseLevel:"none",outputFormat:"both",dpi:"original",enableBasicEnhancement:!0,enableAIUpscale:!1,enableVectorize:!1,vectorizePrecision:"medium"},f=U.map((k,I)=>({id:`img-${Date.now()}-${I}`,file:k,originalUrl:URL.createObjectURL(k),status:"pending",progress:0,options:{...m}}));s(k=>[...k,...f]),n("upload")},[]),p=y.useCallback((U,m)=>{s(f=>f.map(k=>k.id===U?{...k,options:{...k.options,...m}}:k))},[]),x=y.useCallback(U=>{s(m=>{var k,I;const f=m.find(E=>E.id===U);return f&&(URL.revokeObjectURL(f.originalUrl),(k=f.result)!=null&&k.svgUrl&&URL.revokeObjectURL(f.result.svgUrl),(I=f.result)!=null&&I.pngUrl&&URL.revokeObjectURL(f.result.pngUrl)),m.filter(E=>E.id!==U)})},[]),j=y.useCallback(()=>{if(t.length===0)return;n("processing"),l({total:t.length,completed:0,failed:0,currentIndex:0,startTime:Date.now()});const U={onImageStart:f=>{s(k=>k.map(I=>I.id===f?{...I,status:"processing",progress:0}:I))},onImageProgress:(f,k)=>{s(I=>I.map(E=>E.id===f?{...E,progress:Math.round(k)}:E))},onImageComplete:(f,k)=>{s(I=>I.map(E=>E.id===f?{...E,status:"completed",progress:100,result:k}:E)),l(I=>({...I,completed:I.completed+1,currentIndex:I.currentIndex+1}))},onImageError:(f,k,I)=>{s(E=>E.map(G=>G.id===f?{...G,status:"failed",error:k}:G)),l(E=>({...E,failed:E.failed+1,currentIndex:Math.min(E.currentIndex+1,t.length)})),I!=null&&I.userAborted?typeof window<"u"&&window.alert("å¤„ç†å·²åœæ­¢ï¼šç”¨æˆ·å–æ¶ˆäº† CPU æ¨¡å¼æ”¾å¤§ã€‚"):I!=null&&I.skip||typeof window<"u"&&window.alert(`å¤„ç†å¤±è´¥ï¼š${k}`)},onQueueComplete:()=>{setTimeout(()=>{n("results")},1e3)},onQueueAborted:()=>{setTimeout(()=>{n("upload")},300)}},m=new Me(U);h.current=m,m.addImages(t),m.start()},[t]),D=y.useCallback(()=>{i()},[i]),v=y.useCallback(()=>{n("results")},[]),N=y.useCallback(()=>{n("processing")},[]);return e.jsxs("div",{className:"app",children:[a==="upload"&&t.length===0&&e.jsx(xe,{}),e.jsxs("main",{className:"main-content",children:[a==="upload"&&e.jsx(e.Fragment,{children:t.length===0?e.jsx(je,{onFilesSelected:d}):e.jsx(Ue,{images:t,onUpdateOptions:p,onRemoveImage:x,onStartProcessing:j,onAddMore:d})}),a==="processing"&&e.jsx(Pe,{images:t,stats:c,onComplete:v}),a==="results"&&e.jsx(Ce,{images:t,onBackToUpload:D,onBackToProcessing:N})]}),e.jsx("footer",{className:"footer",children:e.jsx("div",{className:"footer-content",children:e.jsx("button",{className:"reset-button",onClick:i,children:"æ¸…é™¤ç¼“å­˜å¹¶åˆ·æ–°"})})})]})}he.createRoot(document.getElementById("root")).render(e.jsx(pe.StrictMode,{children:e.jsx(Be,{})}));
