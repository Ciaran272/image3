const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./aiUpscale-BFKUS1xm.js","./vendor-ai-Cjay71on.js","./vendor-other-B_-1jgMS.js"])))=>i.map(i=>d[i]);
var oe=Object.defineProperty;var de=(a,l,t)=>l in a?oe(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t;var W=(a,l,t)=>de(a,typeof l!="symbol"?l+"":l,t);import{j as e,r as v,T as ue,C as te,c as he,R as pe}from"./vendor-react-lLDS_VkD.js";import{i as ne}from"./vendor-other-B_-1jgMS.js";import{F as V,J as le,p as me}from"./vendor-utils-DXtK3xK1.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))s(c);new MutationObserver(c=>{for(const n of c)if(n.type==="childList")for(const h of n.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function t(c){const n={};return c.integrity&&(n.integrity=c.integrity),c.referrerPolicy&&(n.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?n.credentials="include":c.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(c){if(c.ep)return;c.ep=!0;const n=t(c);fetch(c.href,n)}})();const fe="modulepreload",ge=function(a,l){return new URL(a,l).href},ae={},ie=function(l,t,s){let c=Promise.resolve();if(t&&t.length>0){const h=document.getElementsByTagName("link"),r=document.querySelector("meta[property=csp-nonce]"),d=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));c=Promise.allSettled(t.map(p=>{if(p=ge(p,s),p in ae)return;ae[p]=!0;const g=p.endsWith(".css"),x=g?'[rel="stylesheet"]':"";if(!!s)for(let y=h.length-1;y>=0;y--){const D=h[y];if(D.href===p&&(!g||D.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${p}"]${x}`))return;const N=document.createElement("link");if(N.rel=g?"stylesheet":fe,g||(N.as="script"),N.crossOrigin="",N.href=p,d&&N.setAttribute("nonce",d),document.head.appendChild(N),g)return new Promise((y,D)=>{N.addEventListener("load",y),N.addEventListener("error",()=>D(new Error(`Unable to preload CSS for ${p}`)))})}))}function n(h){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=h,window.dispatchEvent(r),!r.defaultPrevented)throw h}return c.then(h=>{for(const r of h||[])r.status==="rejected"&&n(r.reason);return l().catch(n)})};function xe(){return e.jsx("header",{className:"header",children:e.jsx("div",{className:"header-content",children:e.jsx("div",{className:"logo",children:e.jsxs("div",{className:"logo-text",children:[e.jsx("h1",{children:"Image Processor"}),e.jsx("p",{children:"é«˜æ¸…Â·ä¼˜åŒ–é”¯é½¿"})]})})})})}function je({onFilesSelected:a}){const[l,t]=v.useState(!1),s=v.useCallback(r=>{r.preventDefault(),t(!0)},[]),c=v.useCallback(r=>{r.preventDefault(),t(!1)},[]),n=v.useCallback(r=>{r.preventDefault(),t(!1);const d=Array.from(r.dataTransfer.files).filter(p=>p.type.startsWith("image/"));d.length>0&&a(d)},[a]),h=v.useCallback(r=>{const d=Array.from(r.target.files||[]);d.length>0&&a(d)},[a]);return e.jsx("div",{className:"upload-zone-container",children:e.jsxs("div",{className:`upload-zone ${l?"dragging":""}`,onDragOver:s,onDragLeave:c,onDrop:n,children:[e.jsx("div",{className:"upload-icon",children:e.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 80 80",fill:"none",children:[e.jsx("circle",{cx:"40",cy:"40",r:"38",stroke:"url(#uploadGradient)",strokeWidth:"2",strokeDasharray:"4 4"}),e.jsx("path",{d:"M40 25V55M40 25L30 35M40 25L50 35",stroke:"url(#uploadGradient)",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M25 50C25 50 25 60 30 60H50C55 60 55 50 55 50",stroke:"url(#uploadGradient)",strokeWidth:"3",strokeLinecap:"round"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"uploadGradient",x1:"0",y1:"0",x2:"80",y2:"80",children:[e.jsx("stop",{offset:"0%",stopColor:"#4A90E2"}),e.jsx("stop",{offset:"100%",stopColor:"#7DD3C0"})]})})]})}),e.jsx("h2",{children:"ä¸Šä¼ å›¾ç‰‡å¼€å§‹å¤„ç†"}),e.jsx("p",{className:"upload-description",children:"æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„ï¼Œæˆ–ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®é€‰æ‹©æ–‡ä»¶"}),e.jsxs("label",{className:"upload-button",children:[e.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:h,style:{display:"none"}}),e.jsx("span",{children:"é€‰æ‹©å›¾ç‰‡"})]}),e.jsxs("div",{className:"upload-tips",children:[e.jsxs("div",{className:"tip-item",children:[e.jsx("span",{className:"tip-icon",children:"âœ“"}),e.jsx("span",{children:"æ”¯æŒ JPGã€PNGã€WebP ç­‰æ ¼å¼"})]}),e.jsxs("div",{className:"tip-item",children:[e.jsx("span",{className:"tip-icon",children:"âœ“"}),e.jsx("span",{children:"æ”¯æŒæ‰¹é‡ä¸Šä¼ å¤„ç†"})]})]})]})})}function H({value:a,options:l,onChange:t,placeholder:s,className:c,disabled:n=!1,compact:h=!1}){var J;const r=v.useRef(null),d=v.useRef(null),p=v.useRef(null),[g,x]=v.useState(!1),[E,N]=v.useState(0),y=v.useMemo(()=>l.findIndex(w=>w.value===a),[l,a]);v.useEffect(()=>{y>=0&&N(y)},[y,g]);const D=y>=0?l[y]:void 0,m=v.useCallback(()=>{x(!1)},[]),U=v.useCallback(()=>{n||x(w=>!w)},[n]),k=v.useCallback(w=>{if(!g)return;const S=r.current;S&&!S.contains(w.target)&&m()},[g,m]),I=v.useCallback(w=>{g&&w.key==="Escape"&&(w.preventDefault(),m())},[g,m]);v.useEffect(()=>(document.addEventListener("mousedown",k),document.addEventListener("keydown",I),()=>{document.removeEventListener("mousedown",k),document.removeEventListener("keydown",I)}),[k,I]);const b=v.useCallback(w=>{t(w),m(),requestAnimationFrame(()=>{var S;(S=d.current)==null||S.focus()})},[m,t]),R=v.useCallback(w=>{if(w.value===a){m();return}b(w.value)},[b,m,a]),F=v.useCallback(w=>{const S=p.current;if(!S)return;const L=S.children[w];if(!L)return;const _=L.offsetTop,G=_+L.offsetHeight,$=S.scrollTop,Q=$+S.clientHeight;_<$?S.scrollTop=_:G>Q&&(S.scrollTop=G-S.clientHeight)},[]),T=v.useCallback(w=>{if(!n){if(w.key===" "||w.key==="Enter"){w.preventDefault(),U();return}if(w.key==="ArrowDown"){if(w.preventDefault(),!g){x(!0);return}N(S=>{const L=Math.min(l.length-1,S+1);return F(L),L})}if(w.key==="ArrowUp"){if(w.preventDefault(),!g){x(!0);return}N(S=>{const L=Math.max(0,S-1);return F(L),L})}if(w.key==="Home"&&(w.preventDefault(),g||x(!0),F(0),N(0)),w.key==="End"){w.preventDefault();const S=Math.max(0,l.length-1);g||x(!0),F(S),N(S)}if(w.key==="Tab"&&m(),(w.key==="Enter"||w.key===" ")&&g){w.preventDefault();const S=l[E];S&&b(S.value)}}},[n,U,g,l,E,b,m,F]),q=v.useCallback((w,S)=>{if(w.key==="Enter"||w.key===" "){w.preventDefault();const L=l[S];L&&b(L.value)}},[b,l]);return e.jsxs("div",{ref:r,className:ne("styled-select",c,{"styled-select--open":g,"styled-select--disabled":n,"styled-select--compact":h}),"data-selected-label":D?String(D.label):"",style:h?{minWidth:130}:void 0,children:[e.jsxs("button",{type:"button",ref:d,className:"styled-select-trigger",onClick:U,onKeyDown:T,disabled:n,"aria-haspopup":"listbox","aria-expanded":g,children:[e.jsx("span",{className:"styled-select-value",children:D?D.label:s??"è¯·é€‰æ‹©"}),e.jsx("span",{className:"styled-select-icon","aria-hidden":"true",children:e.jsx("svg",{width:"14",height:"10",viewBox:"0 0 14 10",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M1 3L7 9L13 3",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),e.jsx("ul",{ref:p,className:"styled-select-dropdown",role:"listbox",tabIndex:-1,"aria-activedescendant":E>=0?`styled-select-option-${String((J=l[E])==null?void 0:J.value)}`:void 0,hidden:!g,children:l.map((w,S)=>{const L=w.value===a,_=S===E;return e.jsxs("li",{id:`styled-select-option-${String(w.value)}`,role:"option","aria-selected":L,className:ne("styled-select-option",{"styled-select-option--selected":L,"styled-select-option--highlighted":_}),onMouseEnter:()=>N(S),onMouseDown:G=>G.preventDefault(),onClick:()=>R(w),onKeyDown:G=>q(G,S),tabIndex:-1,children:[e.jsx("span",{className:"styled-select-option-label",children:w.label}),w.description?e.jsx("span",{className:"styled-select-option-description",children:w.description}):null]},String(w.value))})})]})}const be=[{value:2,label:"2x"},{value:3,label:"3x"},{value:4,label:"4x"}],we=[{value:"none",label:"ä¸å˜"},{value:"light",label:"è½»åº¦å»å™ª"},{value:"medium",label:"ä¸­åº¦å»å™ª"},{value:"heavy",label:"é‡åº¦å»å™ª"}],ve=[{value:"svg",label:"SVG"},{value:"png",label:"PNG"},{value:"both",label:"ä¸¤ç§"}],Ne=[{value:"original",label:"ä¸å˜"},{value:72,label:"72DPI"},{value:150,label:"150DPI"},{value:300,label:"300DPI"},{value:600,label:"600DPI"}];function ye({options:a,onUpdateOptions:l,variant:t="default",className:s}){const c=["basic-settings-grid"];return t==="compact"&&c.push("basic-settings-grid--compact"),s&&c.push(s),e.jsxs("div",{className:c.join(" "),children:[e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"æ”¾å¤§å€æ•°"}),e.jsx(H,{value:a.upscaleFactor,options:be,onChange:n=>l({upscaleFactor:n}),compact:t==="compact"})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"å»å™ªå¼ºåº¦"}),e.jsx(H,{value:a.denoiseLevel,options:we,onChange:n=>l({denoiseLevel:n}),compact:t==="compact"})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"è¾“å‡ºæ ¼å¼"}),e.jsx(H,{value:a.outputFormat,options:ve,onChange:n=>l({outputFormat:n}),compact:t==="compact"})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"è¾“å‡º DPI"}),e.jsx(H,{value:a.dpi,options:Ne,onChange:n=>l({dpi:n}),compact:t==="compact"})]})]})}function ke({options:a,onUpdateOptions:l,variant:t="default",className:s,showReminders:c=!0}){const n=["processing-pipeline"];return t==="compact"&&n.push("processing-pipeline--compact"),s&&n.push(s),e.jsxs("div",{className:n.join(" "),children:[e.jsxs("div",{className:t==="compact"?"pipeline-pill-group":"pipeline-checkbox-group",children:[e.jsxs("label",{className:t==="compact"?"pipeline-pill":"pipeline-checkbox",children:[e.jsx("input",{type:"checkbox",checked:a.enableBasicEnhancement,onChange:h=>l({enableBasicEnhancement:h.target.checked})}),e.jsx("span",{children:"åŸºç¡€æ”¾å¤§å’Œå»å™ª"})]}),e.jsxs("label",{className:t==="compact"?"pipeline-pill":"pipeline-checkbox",children:[e.jsx("input",{type:"checkbox",checked:a.enableAIUpscale,onChange:h=>l({enableAIUpscale:h.target.checked})}),e.jsx("span",{children:"AI è¶…åˆ†è¾¨ç‡"})]}),e.jsxs("label",{className:t==="compact"?"pipeline-pill":"pipeline-checkbox",children:[e.jsx("input",{type:"checkbox",checked:a.enableVectorize,onChange:h=>l({enableVectorize:h.target.checked})}),e.jsx("span",{children:"ä½å›¾è½¬çŸ¢é‡"})]})]}),c?t==="compact"?e.jsxs("div",{className:"pipeline-reminders pipeline-reminders--compact",children:[a.enableAIUpscale?e.jsxs("div",{className:"pipeline-warning",children:[e.jsx("span",{className:"pipeline-warning__icon","aria-hidden":"true",children:"âš ï¸"}),e.jsx("span",{className:"pipeline-warning__text",children:"è€—æ—¶è¾ƒä¹…ï¼Œå ç”¨æ˜¾å­˜ï¼ˆæ˜¾å¡/æµè§ˆå™¨æ€§èƒ½ï¼‰"})]}):null,a.enableAIUpscale&&a.enableBasicEnhancement?e.jsxs("div",{className:"pipeline-hint",children:[e.jsx("span",{className:"pipeline-hint__icon","aria-hidden":"true",children:"ğŸ’¡"}),e.jsx("span",{className:"pipeline-hint__text",children:"AI è¶…åˆ†ä¼šç›´æ¥å¤„ç†åŸå›¾ä»¥é¿å…å†…å­˜è¶…é™"})]}):null]}):e.jsxs(e.Fragment,{children:[a.enableAIUpscale&&e.jsxs("div",{className:"pipeline-warning",children:[e.jsx("span",{className:"pipeline-warning__icon","aria-hidden":"true",children:"âš ï¸"}),e.jsx("span",{className:"pipeline-warning__text",children:"è€—æ—¶è¾ƒä¹…ï¼Œå ç”¨æ˜¾å­˜ï¼ˆæ˜¾å¡/æµè§ˆå™¨æ€§èƒ½ï¼‰"})]}),a.enableAIUpscale&&a.enableBasicEnhancement&&e.jsxs("div",{className:"pipeline-hint",children:[e.jsx("span",{className:"pipeline-hint__icon","aria-hidden":"true",children:"ğŸ’¡"}),e.jsx("span",{className:"pipeline-hint__text",children:"AI è¶…åˆ†ä¼šç›´æ¥å¤„ç†åŸå›¾ä»¥é¿å…å†…å­˜è¶…é™"})]})]}):null]})}function Ie({images:a,onRemoveImage:l,reminderContent:t}){return e.jsxs("div",{className:"image-gallery",children:[e.jsxs("div",{className:"gallery-header",children:[e.jsxs("div",{className:"gallery-title-block",children:[e.jsx("h3",{children:"ğŸï¸ å›¾ç‰‡åˆ—è¡¨"}),Array.isArray(t)?e.jsx(ue,{className:"inline-reminders",children:t}):t]}),e.jsxs("span",{className:"image-count",children:["å…± ",a.length," å¼ "]})]}),e.jsx("div",{className:"gallery-grid",children:a.map(s=>e.jsxs("div",{className:"gallery-item",children:[e.jsxs("div",{className:"gallery-preview",children:[e.jsx("img",{src:s.originalUrl,alt:s.file.name}),e.jsx("button",{className:"remove-btn",onClick:()=>l(s.id),title:"ç§»é™¤",children:"Ã—"})]}),e.jsxs("div",{className:"gallery-info",children:[e.jsx("h4",{className:"gallery-name",title:s.file.name,children:s.file.name}),e.jsxs("p",{className:"gallery-size",children:[(s.file.size/1024/1024).toFixed(2)," MB"]})]})]},s.id))})]})}function Ue({images:a,onUpdateOptions:l,onRemoveImage:t,onStartProcessing:s,onAddMore:c}){var N;const[n,h]=v.useState(((N=a[0])==null?void 0:N.options)||{upscaleFactor:2,denoiseLevel:"none",outputFormat:"both",dpi:"original",enableBasicEnhancement:!0,enableAIUpscale:!1,enableVectorize:!1,vectorizePrecision:"medium"}),r=y=>{const D=Array.from(y.target.files||[]);D.length>0&&c(D)},d=y=>{const D={...n,...y};h(D),a.forEach(m=>{l(m.id,y)})},p=n.enableAIUpscale,g=n.enableAIUpscale&&n.enableBasicEnhancement,x=[];p&&x.push(e.jsx(te,{classNames:"reminder-bubble",timeout:240,appear:!0,children:e.jsxs("div",{className:"pipeline-warning",children:[e.jsx("span",{className:"pipeline-warning__icon","aria-hidden":"true",children:"â—"}),e.jsx("span",{className:"pipeline-warning__text",children:"å ç”¨æ˜¾å­˜ï¼Œè€—æ—¶è¾ƒä¹…ï¼ˆéœ€è¦æ˜¾å¡/æµè§ˆå™¨æ€§èƒ½ï¼‰"})]})},"ai-warning")),g&&x.push(e.jsx(te,{classNames:"reminder-bubble",timeout:240,appear:!0,children:e.jsxs("div",{className:"pipeline-hint",children:[e.jsx("span",{className:"pipeline-hint__icon","aria-hidden":"true",children:"â›”"}),e.jsx("span",{className:"pipeline-hint__text",children:"è‹¥è¶…å‡ºé˜ˆå€¼ä¼šé™çº§å¤„ç†"})]})},"ai-hint"));const E=x.length>0?x:null;return v.useEffect(()=>{a.forEach(y=>{(y.options.upscaleFactor!==n.upscaleFactor||y.options.denoiseLevel!==n.denoiseLevel||y.options.outputFormat!==n.outputFormat||y.options.dpi!==n.dpi||y.options.enableBasicEnhancement!==n.enableBasicEnhancement||y.options.enableAIUpscale!==n.enableAIUpscale||y.options.enableVectorize!==n.enableVectorize||y.options.vectorizePrecision!==n.vectorizePrecision)&&l(y.id,{upscaleFactor:n.upscaleFactor,denoiseLevel:n.denoiseLevel,outputFormat:n.outputFormat,dpi:n.dpi,enableBasicEnhancement:n.enableBasicEnhancement,enableAIUpscale:n.enableAIUpscale,enableVectorize:n.enableVectorize,vectorizePrecision:n.vectorizePrecision})})},[a,n,l]),e.jsxs("div",{className:"image-list-container",children:[e.jsxs("div",{className:"list-header",children:[e.jsxs("div",{className:"header-settings-bar",children:[e.jsx(ye,{options:n,onUpdateOptions:d,variant:"compact"}),e.jsx(ke,{options:n,onUpdateOptions:d,variant:"compact",showReminders:!1})]}),e.jsxs("div",{className:"header-actions",children:[e.jsxs("label",{className:"add-more-button",children:[e.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:r,style:{display:"none"}}),e.jsx("span",{children:"â• æ·»åŠ æ›´å¤š"})]}),e.jsx("button",{className:"start-button",onClick:s,children:"â–¶ï¸ å¼€å§‹å¤„ç†"})]})]}),e.jsx("div",{className:"content-layout",children:e.jsx("div",{className:"image-gallery-wrapper",children:e.jsx(Ie,{images:a,onRemoveImage:t,reminderContent:E})})})]})}function Pe({images:a,stats:l,onComplete:t}){const s=Math.min(l.completed+l.failed,l.total),c=s>=l.total&&l.total>0,n=Math.min(l.currentIndex,a.length-1),h=!c&&n>=0&&n<a.length?a[n]:void 0,r=l.total>0?s/l.total*100:0,d=()=>{if(l.completed+l.failed>=l.total)return"å³å°†å®Œæˆ...";if(!l.startTime||l.completed===0)return"è®¡ç®—ä¸­...";const g=(Date.now()-l.startTime)/l.completed,x=(l.total-l.completed-l.failed)*g;if(x<=0)return"å³å°†å®Œæˆ...";const E=Math.floor(x/6e4),N=Math.floor(x%6e4/1e3);return E>0?`çº¦ ${E} åˆ† ${N} ç§’`:`çº¦ ${N} ç§’`};return e.jsxs("div",{className:"processing-panel",children:[e.jsxs("div",{className:"processing-header",children:[e.jsx("h2",{children:c?"å¤„ç†å·²å®Œæˆï¼":"æ­£åœ¨å¤„ç†å›¾ç‰‡..."}),e.jsx("p",{className:"processing-subtitle",children:c?"æ‰€æœ‰å›¾ç‰‡å¤„ç†å®Œæˆï¼Œå³å°†è·³è½¬åˆ°ç»“æœé¡µé¢...":""}),c&&e.jsx("button",{className:"view-results-button",type:"button",onClick:t,children:"ğŸ“Š æŸ¥çœ‹å¤„ç†ç»“æœ"})]}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsxs("div",{className:"stat-value",children:[s," / ",l.total]}),e.jsx("div",{className:"stat-label",children:"å½“å‰è¿›åº¦"})]}),e.jsxs("div",{className:"stat-card success",children:[e.jsx("div",{className:"stat-value",children:l.completed}),e.jsx("div",{className:"stat-label",children:"å·²å®Œæˆ"})]}),e.jsxs("div",{className:"stat-card error",children:[e.jsx("div",{className:"stat-value",children:l.failed}),e.jsx("div",{className:"stat-label",children:"å¤±è´¥/è·³è¿‡"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-value",children:d()}),e.jsx("div",{className:"stat-label",children:"é¢„è®¡å‰©ä½™"})]})]}),e.jsxs("div",{className:"progress-section",children:[e.jsxs("div",{className:"progress-header",children:[e.jsx("span",{children:"æ€»ä½“è¿›åº¦"}),e.jsxs("span",{className:"progress-percentage",children:[r.toFixed(0),"%"]})]}),e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${Math.max(0,Math.min(100,r))}%`}})})]}),h&&e.jsxs("div",{className:"current-image-section",children:[e.jsx("h3",{children:"å½“å‰å¤„ç†"}),e.jsxs("div",{className:"current-image-card",children:[e.jsx("div",{className:"current-image-preview",children:e.jsx("img",{src:h.originalUrl,alt:h.file.name})}),e.jsxs("div",{className:"current-image-info",children:[e.jsx("h4",{children:h.file.name}),e.jsx("div",{className:"processing-steps",children:e.jsxs("div",{className:"step active",children:[e.jsx("div",{className:"step-icon",children:e.jsx("div",{className:"spinner"})}),e.jsx("span",{children:"å¤„ç†ä¸­..."})]})})]})]})]}),e.jsxs("div",{className:"completed-list",children:[e.jsx("h3",{children:"å·²å¤„ç†åˆ—è¡¨"}),e.jsx("div",{className:"completed-items",children:a.filter(p=>p.status==="completed"||p.status==="failed").map(p=>{var g;return e.jsxs("div",{className:`completed-item ${p.status}`,children:[e.jsx("div",{className:"completed-icon",children:p.status==="completed"?"âœ“":"âœ—"}),e.jsx("span",{className:"completed-name",children:p.file.name}),e.jsx("span",{className:"completed-size-change",children:(()=>{var y;if(p.status!=="completed")return"--";const x=p.file.size/1024/1024,E=(y=p.result)==null?void 0:y.pngSize;if(!E)return`${x.toFixed(2)}MB`;const N=E/1024/1024;return`${x.toFixed(2)}MB â†’ ${N.toFixed(2)}MB`})()}),e.jsx("span",{className:"completed-status",children:p.status==="completed"?`${(((g=p.result)==null?void 0:g.processingTime)||0)/1e3}s`:p.error||"å¤±è´¥"})]},p.id)})})]})]})}function Ce({images:a,onBackToUpload:l,onBackToProcessing:t}){var K,X,Y,Z,ee,se;const[s,c]=v.useState(null),[n,h]=v.useState(!1),[r,d]=v.useState(new Set),[p,g]=v.useState(!1),[x,E]=v.useState(90),[N,y]=v.useState(new Map),[D,m]=v.useState(!1),U=a.filter(i=>i.status==="completed"),k=a.filter(i=>i.status==="failed").map(i=>({id:i.id,filename:i.file.name,reason:i.error||"æœªçŸ¥é”™è¯¯"})),I=U.filter(i=>{var f;return!!((f=i.result)!=null&&f.pngUrl)}),b=I.length>0,F=I.filter(i=>r.has(i.id)).length,T=async(i,f)=>{if(!i.result)return;const j=f==="svg"?i.result.svgUrl:i.result.pngUrl;if(!j)return;const u=await(await fetch(j)).blob(),P=f==="svg"?".svg":".png",C=i.file.name.replace(/\.[^/.]+$/,"")+`_processed${P}`;V.saveAs(u,C)},q=async()=>{const i=new le;for(const j of U){if(!j.result)continue;const o=j.file.name.replace(/\.[^/.]+$/,"");if(j.result.svgUrl){const P=await(await fetch(j.result.svgUrl)).blob();i.file(`${o}.svg`,P)}if(j.result.pngUrl){const P=await(await fetch(j.result.pngUrl)).blob();i.file(`${o}.png`,P)}}const f=await i.generateAsync({type:"blob"});V.saveAs(f,`processed_images_${Date.now()}.zip`)},J=i=>{d(f=>{const j=new Set(f);return j.has(i)?j.delete(i):j.add(i),j})},w=()=>{r.size===U.length?d(new Set):d(new Set(U.map(i=>i.id)))},S=async()=>{const i=I.filter(f=>r.has(f.id));if(i.length===0){alert("é€‰ä¸­çš„å›¾ç‰‡ä¸­æ²¡æœ‰å¯ç”¨çš„ PNG ç»“æœ");return}try{if("showDirectoryPicker"in window){const f=await window.showDirectoryPicker({mode:"readwrite"});for(const j of i){const u=await(await fetch(j.result.pngUrl)).blob(),P=j.file.name.replace(/\.[^/.]+$/,"")+"_processed.png",B=await(await f.getFileHandle(P,{create:!0})).createWritable();await B.write(u),await B.close()}alert(`æˆåŠŸä¸‹è½½ ${i.length} å¼  PNG å›¾ç‰‡ï¼`)}else{for(const f of i){const o=await(await fetch(f.result.pngUrl)).blob(),u=f.file.name.replace(/\.[^/.]+$/,"")+"_processed.png";V.saveAs(o,u),await new Promise(P=>setTimeout(P,300))}alert(`å·²è§¦å‘ ${i.length} ä¸ªä¸‹è½½ï¼Œè¯·åœ¨æµè§ˆå™¨ä¸‹è½½æ æŸ¥çœ‹`)}}catch(f){f.name!=="AbortError"&&(console.error("ä¸‹è½½å¤±è´¥:",f),alert("ä¸‹è½½å¤±è´¥ï¼Œè¯·é‡è¯•"))}},L=async i=>{try{const j=await(await fetch(i)).arrayBuffer(),o=new Uint8Array(j);if(o[0]!==137||o[1]!==80||o[2]!==78||o[3]!==71)return null;let u=8;for(;u<o.length-12;){const P=o[u]<<24|o[u+1]<<16|o[u+2]<<8|o[u+3],C=String.fromCharCode(o[u+4],o[u+5],o[u+6],o[u+7]);if(C==="pHYs"){const B=o[u+8]<<24|o[u+9]<<16|o[u+10]<<8|o[u+11];if(o[u+16]===1)return Math.round(B/39.3701)}if(C==="IEND")break;u+=12+P}return null}catch(f){return console.warn("è¯»å– PNG DPI å¤±è´¥:",f),null}},_=async(i,f,j)=>new Promise((o,u)=>{const P=new Image;P.crossOrigin="anonymous",P.onload=()=>{const C=document.createElement("canvas"),B=C.getContext("2d");if(!B){u(new Error("æ— æ³•åˆ›å»º Canvas ä¸Šä¸‹æ–‡"));return}C.width=P.width,C.height=P.height,B.fillStyle="#FFFFFF",B.fillRect(0,0,C.width,C.height),B.drawImage(P,0,0),C.toBlob(async z=>{if(z)try{if(j&&j>0){const A=await G(z,j);o({blob:A,size:A.size})}else o({blob:z,size:z.size})}catch(A){console.warn("æ·»åŠ  JPEG DPI å…ƒæ•°æ®å¤±è´¥ï¼Œä½¿ç”¨åŸå§‹å›¾ç‰‡",A),o({blob:z,size:z.size})}else u(new Error("è½¬æ¢å¤±è´¥"))},"image/jpeg",f/100)},P.onerror=()=>u(new Error("å›¾ç‰‡åŠ è½½å¤±è´¥")),P.src=i}),G=async(i,f)=>{const j=await i.arrayBuffer(),o=new Uint8Array(j);if(o[0]!==255||o[1]!==216)throw new Error("ä¸æ˜¯æœ‰æ•ˆçš„ JPEG æ–‡ä»¶");let u=2,P=!1,C=-1;for(;u<o.length-1;)if(o[u]===255){const A=o[u+1];if(A===224&&String.fromCharCode(o[u+4],o[u+5],o[u+6],o[u+7],o[u+8])==="JFIF\0"){P=!0,C=u;break}if(A>=208&&A<=217)u+=2;else if(A!==0&&A!==255){const M=o[u+2]<<8|o[u+3];u+=2+M}else u+=2}else u++;const z=(A=>{const M=new Uint8Array(18),O=new DataView(M.buffer);return O.setUint8(0,255),O.setUint8(1,224),O.setUint16(2,16,!1),M[4]=74,M[5]=70,M[6]=73,M[7]=70,M[8]=0,O.setUint8(9,1),O.setUint8(10,1),O.setUint8(11,1),O.setUint16(12,A,!1),O.setUint16(14,A,!1),O.setUint8(16,0),O.setUint8(17,0),M})(f);if(P&&C>=0){const A=o[C+2]<<8|o[C+3],M=new Uint8Array(o.length-A-2+z.length);return M.set(o.slice(0,C),0),M.set(z,C),M.set(o.slice(C+2+A),C+z.length),new Blob([M],{type:"image/jpeg"})}else{const A=new Uint8Array(o.length+z.length);return A.set(o.slice(0,2),0),A.set(z,2),A.set(o.slice(2),2+z.length),new Blob([A],{type:"image/jpeg"})}},$=async i=>{const f=U.filter(o=>{var u;return r.has(o.id)&&((u=o.result)==null?void 0:u.pngUrl)}),j=new Map;for(const o of f)try{let u;o.options.dpi==="original"?u=await L(o.result.pngUrl)||void 0:u=Number(o.options.dpi);const{size:P}=await _(o.result.pngUrl,i,u);j.set(o.id,P)}catch(u){console.error(`é¢„è§ˆå¤±è´¥: ${o.file.name}`,u)}y(j)};v.useEffect(()=>{if(!p)return;const i=setTimeout(()=>{$(x)},300);return()=>clearTimeout(i)},[x,p,r]);const Q=async()=>{const i=U.filter(f=>{var j;return r.has(f.id)&&((j=f.result)==null?void 0:j.pngUrl)});if(i.length===0){alert("è¯·å…ˆå‹¾é€‰è¦è½¬æ¢çš„å›¾ç‰‡");return}m(!0);try{if(i.length===1){const f=i[0];let j;f.options.dpi==="original"?j=await L(f.result.pngUrl)||void 0:j=Number(f.options.dpi);const{blob:o}=await _(f.result.pngUrl,x,j),u=f.file.name.replace(/\.[^/.]+$/,"")+".jpg";V.saveAs(o,u),alert("è½¬æ¢å®Œæˆï¼")}else{const f=new le;for(const o of i){let u;o.options.dpi==="original"?u=await L(o.result.pngUrl)||void 0:u=Number(o.options.dpi);const{blob:P}=await _(o.result.pngUrl,x,u),C=o.file.name.replace(/\.[^/.]+$/,"")+".jpg";f.file(C,P)}const j=await f.generateAsync({type:"blob"});V.saveAs(j,`jpeg_images_q${x}_${Date.now()}.zip`),alert(`æˆåŠŸè½¬æ¢å¹¶æ‰“åŒ… ${i.length} å¼  JPEG å›¾ç‰‡ï¼`)}g(!1)}catch(f){console.error("è½¬æ¢å¤±è´¥:",f),alert("è½¬æ¢å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{m(!1)}};return e.jsxs("div",{className:"results-view",children:[e.jsx("div",{className:"results-header",children:e.jsxs("div",{className:"results-header-actions",children:[e.jsx("button",{className:"select-all-button",onClick:w,children:r.size===U.length?"å–æ¶ˆå…¨é€‰":"å…¨é€‰æˆåŠŸå›¾ç‰‡"}),b&&e.jsxs("button",{className:"download-png-button",onClick:S,disabled:F===0,children:["ğŸ“¥ ä¸‹è½½é€‰ä¸­ PNG (",F,")"]}),b&&e.jsxs("button",{className:"convert-jpeg-button",onClick:()=>{if(F===0){alert("è¯·å…ˆå‹¾é€‰åŒ…å« PNG ç»“æœçš„å›¾ç‰‡");return}g(!0),$(x)},disabled:F===0,children:["ğŸ¨ è½¬æ¢ä¸º JPEG (",F,")"]}),t&&e.jsx("button",{className:"back-to-processing-button",onClick:t,children:"ğŸ” æŸ¥çœ‹å¤„ç†è¯¦æƒ…"}),e.jsx("button",{className:"download-all-button",onClick:q,children:"ğŸ“¦ ä¸‹è½½å…¨éƒ¨ç»“æœ"}),e.jsx("button",{className:"back-button",onClick:l,children:"â† è¿”å›ä¸Šä¼ é¡µ"})]})}),k.length>0&&e.jsxs("div",{className:"failed-section",children:[e.jsx("h3",{children:"å¤„ç†å¤±è´¥"}),e.jsx("div",{className:"failed-list",children:k.map(i=>e.jsxs("div",{className:"failed-item",children:[e.jsx("span",{className:"failed-icon",children:"âœ—"}),e.jsx("span",{className:"failed-name",children:i.filename}),e.jsx("span",{className:"failed-reason",children:i.reason})]},i.id))})]}),e.jsx("div",{className:"results-grid",children:U.map(i=>{var f,j,o,u,P;return e.jsxs("div",{className:`result-card ${r.has(i.id)?"checked":""}`,onClick:()=>c(i),children:[e.jsxs("div",{className:"result-preview",children:[e.jsx("div",{className:"checkbox-container",onClick:C=>{C.stopPropagation(),J(i.id)},children:e.jsx("input",{type:"checkbox",checked:r.has(i.id),onChange:()=>{},className:"image-checkbox"})}),e.jsx("img",{src:((f=i.result)==null?void 0:f.pngUrl)||((j=i.result)==null?void 0:j.svgUrl)||i.originalUrl,alt:i.file.name}),e.jsx("div",{className:"result-overlay",children:e.jsx("button",{className:"view-button",children:"ğŸ” æŸ¥çœ‹è¯¦æƒ…"})})]}),e.jsxs("div",{className:"result-info",children:[e.jsx("h4",{children:i.file.name}),e.jsxs("p",{children:["å¤„ç†æ—¶é—´: ",((((o=i.result)==null?void 0:o.processingTime)||0)/1e3).toFixed(1),"s",(()=>{var z;const C=i.file.size/1024/1024,B=(z=i.result)==null?void 0:z.pngSize;if(B!=null){const A=B/1024/1024;return` | å¤§å°: ${C.toFixed(2)}MB â†’ ${A.toFixed(2)}MB`}return""})()]}),e.jsxs("div",{className:"download-buttons",children:[((u=i.result)==null?void 0:u.svgUrl)&&e.jsx("button",{className:"mini-download-btn svg",onClick:C=>{C.stopPropagation(),T(i,"svg")},children:"SVG"}),((P=i.result)==null?void 0:P.pngUrl)&&e.jsx("button",{className:"mini-download-btn png",onClick:C=>{C.stopPropagation(),T(i,"png")},children:"PNG"})]})]})]},i.id)})}),s&&e.jsx("div",{className:"modal-overlay",onClick:()=>c(null),children:e.jsxs("div",{className:"modal-content",onClick:i=>i.stopPropagation(),children:[e.jsx("button",{className:"modal-close",onClick:()=>c(null),children:"Ã—"}),e.jsx("h3",{children:s.file.name}),e.jsxs("div",{className:"compare-toggle",children:[e.jsx("button",{className:n?"":"active",onClick:()=>h(!1),children:"å¤„ç†å"}),e.jsx("button",{className:n?"active":"",onClick:()=>h(!0),children:"å¯¹æ¯”æŸ¥çœ‹"})]}),n?e.jsxs("div",{className:"compare-view",children:[e.jsxs("div",{className:"compare-item",children:[e.jsx("h4",{children:"åŸå›¾"}),e.jsx("img",{src:s.originalUrl,alt:"åŸå›¾"})]}),e.jsx("div",{className:"compare-divider",children:"â†’"}),e.jsxs("div",{className:"compare-item",children:[e.jsx("h4",{children:"å¤„ç†å"}),e.jsx("img",{src:((Y=s.result)==null?void 0:Y.pngUrl)||((Z=s.result)==null?void 0:Z.svgUrl)||s.originalUrl,alt:"å¤„ç†å"})]})]}):e.jsx("div",{className:"single-view",children:e.jsx("img",{src:((K=s.result)==null?void 0:K.pngUrl)||((X=s.result)==null?void 0:X.svgUrl)||s.originalUrl,alt:"å¤„ç†å"})}),e.jsxs("div",{className:"modal-actions",children:[((ee=s.result)==null?void 0:ee.svgUrl)&&e.jsx("button",{className:"modal-download-btn",onClick:()=>T(s,"svg"),children:"ä¸‹è½½ SVG"}),((se=s.result)==null?void 0:se.pngUrl)&&e.jsx("button",{className:"modal-download-btn",onClick:()=>T(s,"png"),children:"ä¸‹è½½ PNG"})]})]})}),p&&e.jsx("div",{className:"jpeg-modal-overlay",onClick:()=>g(!1),children:e.jsxs("div",{className:"jpeg-modal",onClick:i=>i.stopPropagation(),children:[e.jsx("button",{className:"modal-close",onClick:()=>g(!1),children:"Ã—"}),e.jsx("h3",{children:"ğŸ¨ JPEG è½¬æ¢"}),e.jsxs("p",{className:"modal-info",children:["å·²é€‰ä¸­ ",e.jsx("strong",{children:r.size})," å¼ å›¾ç‰‡"]}),e.jsxs("div",{className:"quality-control",children:[e.jsxs("label",{children:[e.jsx("span",{children:"è´¨é‡:"}),e.jsxs("span",{className:"quality-value",children:[x,"%"]})]}),e.jsx("input",{type:"range",min:"50",max:"100",step:"5",value:x,onChange:i=>E(Number(i.target.value)),className:"quality-slider"}),e.jsxs("div",{className:"quality-marks",children:[e.jsx("span",{children:"50%"}),e.jsx("span",{children:"75%"}),e.jsx("span",{children:"100%"})]})]}),e.jsxs("div",{className:"preview-sizes",children:[e.jsx("h4",{children:"é¢„è®¡æ–‡ä»¶å¤§å°:"}),e.jsx("div",{className:"size-list",children:U.filter(i=>r.has(i.id)).map(i=>{var u;const f=((u=i.result)==null?void 0:u.pngSize)||i.file.size,j=N.get(i.id),o=j?Math.round((1-j/f)*100):0;return e.jsxs("div",{className:"size-item",children:[e.jsx("span",{className:"filename",children:i.file.name}),e.jsxs("span",{className:"size-change",children:[(f/1024/1024).toFixed(2),"MB"," â†’ ",j?`${(j/1024/1024).toFixed(2)}MB`:"è®¡ç®—ä¸­...",j&&e.jsxs("span",{className:"compression",children:[" (â†“",o,"%)"]})]})]},i.id)})}),e.jsxs("div",{className:"total-size",children:[e.jsx("strong",{children:"æ€»å¤§å°:"}),(()=>{const i=U.filter(o=>r.has(o.id)).reduce((o,u)=>{var P;return o+(((P=u.result)==null?void 0:P.pngSize)||u.file.size)},0),f=Array.from(N.values()).reduce((o,u)=>o+u,0),j=f>0?Math.round((1-f/i)*100):0;return e.jsxs(e.Fragment,{children:[" ",(i/1024/1024).toFixed(1),"MB"," â†’ ",N.size>0?`${(f/1024/1024).toFixed(1)}MB`:"è®¡ç®—ä¸­...",N.size>0&&e.jsxs("span",{className:"compression",children:[" (èŠ‚çœ ",j,"%)"]})]})})()]})]}),e.jsx("div",{className:"modal-actions",children:e.jsx("button",{className:"confirm-button",onClick:Q,disabled:D||N.size===0,children:D?"è½¬æ¢ä¸­...":"å¼€å§‹è½¬æ¢å¹¶ä¸‹è½½"})})]})})]})}const Se=async()=>await ie(()=>import("./aiUpscale-BFKUS1xm.js"),__vite__mapDeps([0,1,2]),import.meta.url);async function Ee(a,l){const t=Date.now();try{return l(10),console.log("=== å¼€å§‹å¤„ç†å›¾ç‰‡ ==="),console.log("å¤„ç†æµç¨‹:",{åŸºç¡€å¢å¼º:a.options.enableBasicEnhancement,AIè¶…åˆ†:a.options.enableAIUpscale,çŸ¢é‡åŒ–:a.options.enableVectorize}),await De(a,l,t)}catch(s){throw console.error("å›¾ç‰‡å¤„ç†å¤±è´¥:",s),s}}async function De(a,l,t){let s=20,c,n,h=a.file,r,d;const p=a.options.outputFormat==="png"||a.options.outputFormat==="both",g=a.options.outputFormat==="svg"||a.options.outputFormat==="both",x=a.options.enableBasicEnhancement,E=a.options.enableAIUpscale,N=a.options.enableVectorize&&g;g&&!N&&console.warn("å·²é€‰æ‹© SVG è¾“å‡ºä½†æœªå¯ç”¨çŸ¢é‡åŒ–ï¼Œå°†ä¸ä¼šç”Ÿæˆ SVG ç»“æœ");const y=[x,E,N].filter(Boolean).length,D=y>0?70/y:0;if(x){console.log("æ‰§è¡Œæ­¥éª¤ 1: åŸºç¡€æ”¾å¤§å’Œå»å™ª");const m=await re(h,a.options);r=m.url,n=m.url,d=m.size;try{const k=await(await fetch(r)).blob();h=new File([k],a.file.name,{type:"image/png"})}catch(U){console.warn("æ— æ³•è½¬æ¢ä¸­é—´ç»“æœï¼Œåç»­æ­¥éª¤å°†ä½¿ç”¨åŸå›¾",U)}s+=D,l(s)}if(E){console.log("æ‰§è¡Œæ­¥éª¤ 2: AI è¶…åˆ†è¾¨ç‡ï¼ˆåŸºäºå½“å‰ç»“æœï¼‰");try{if(r&&r!==n)try{URL.revokeObjectURL(r)}catch(b){console.warn("é‡Šæ”¾ä¸­é—´ URL å¤±è´¥",b)}const m=n,{aiUpscale:U,base64ToBlobUrl:k}=await Se(),I=await U(h,a.options.upscaleFactor,b=>l(s+b*(D/100)));if(r=I.startsWith("data:")?k(I):I,n=r,m&&m!==r)try{URL.revokeObjectURL(m)}catch(b){console.warn("é‡Šæ”¾æ—§ PNG URL å¤±è´¥",b)}try{const R=await(await fetch(r)).blob();d=R.size,h=new File([R],a.file.name,{type:"image/png"}),console.log("âœ… AI è¶…åˆ†ç»“æœå·²è½¬æ¢ï¼Œä¾›åç»­æ­¥éª¤ä½¿ç”¨")}catch(b){console.warn("æ— æ³•è½¬æ¢AIè¶…åˆ†ç»“æœï¼Œåç»­æ­¥éª¤å°†ä½¿ç”¨åŸå›¾",b)}s+=D}catch(m){throw console.warn("AI è¶…åˆ†å¤±è´¥ï¼Œç»ˆæ­¢æ­¤å›¾ç‰‡å¤„ç†",m),m}l(s)}if(N){console.log("æ‰§è¡Œæ­¥éª¤ 3: ä½å›¾è½¬çŸ¢é‡ï¼ˆåŸºäºå½“å‰ç»“æœï¼‰");try{c=await Fe(h,a.options),s+=D}catch(m){console.warn("çŸ¢é‡åŒ–å¤±è´¥ï¼Œè·³è¿‡æ­¤æ­¥éª¤",m),s+=D}l(s)}if(!y&&p){console.log("æœªå¯ç”¨ä»»ä½•å¤„ç†ï¼Œä½¿ç”¨åŸºç¡€å¢å¼ºä½œä¸ºé»˜è®¤");const m=await re(a.file,a.options);n=m.url,d=m.size}if(!n&&p){console.warn("æ‰€æœ‰å¤„ç†éƒ½å¤±è´¥ï¼Œæ— æ³•ç”Ÿæˆæ”¾å¤§ç»“æœ");const m=new Error("AI è¶…åˆ†å¤±è´¥ï¼Œæœªç”Ÿæˆæ–°çš„æ”¾å¤§å›¾åƒ");throw m.skipImage=!0,m}if(n&&p&&a.options.dpi!=="original"&&typeof a.options.dpi=="number")try{console.log(`æ­£åœ¨ä¸ºæœ€ç»ˆPNGæ·»åŠ  ${a.options.dpi} DPI å…ƒæ•°æ®...`);const U=await(await fetch(n)).blob(),k=await ce(U,a.options.dpi);URL.revokeObjectURL(n),n=URL.createObjectURL(k),d=k.size,console.log("âœ… DPI å…ƒæ•°æ®æ·»åŠ æˆåŠŸ")}catch(m){console.warn("æ·»åŠ  DPI å…ƒæ•°æ®å¤±è´¥ï¼Œä½¿ç”¨åŸå§‹å›¾ç‰‡",m)}if(l(100),console.log("å¤„ç†å®Œæˆï¼Œè¾“å‡º:",{hasSVG:!!c,hasPNG:!!n,processingTime:Date.now()-t}),!g&&c){try{URL.revokeObjectURL(c)}catch(m){console.warn("é‡Šæ”¾ SVG URL å¤±è´¥",m)}c=void 0}if(!p&&n){try{URL.revokeObjectURL(n)}catch(m){console.warn("é‡Šæ”¾ PNG URL å¤±è´¥",m)}n=void 0,d=void 0}if(!c&&!n){const m=new Error("æœªç”Ÿæˆå¯ç”¨çš„è¾“å‡ºç»“æœï¼Œè¯·æ£€æŸ¥è®¾ç½®");throw m.skipImage=!0,m}return{svgUrl:c,pngUrl:n,pngSize:d,processingTime:Date.now()-t}}async function Ae(a){try{const l=await a.arrayBuffer(),t=new Uint8Array(l);if(t[0]===137&&t[1]===80&&t[2]===78&&t[3]===71){let s=8;for(;s<t.length-12;){const c=t[s]<<24|t[s+1]<<16|t[s+2]<<8|t[s+3],n=String.fromCharCode(t[s+4],t[s+5],t[s+6],t[s+7]);if(n==="pHYs"){const h=t[s+8]<<24|t[s+9]<<16|t[s+10]<<8|t[s+11];if(t[s+16]===1){const d=Math.round(h/39.3701);return console.log(`ä» PNG è¯»å–åˆ° DPI: ${d}`),d}}if(n==="IEND")break;s+=12+c}}else if(t[0]===255&&t[1]===216){let s=2;for(;s<t.length-1;){if(t[s]===255&&t[s+1]===224){if(String.fromCharCode(t[s+4],t[s+5],t[s+6],t[s+7],t[s+8])==="JFIF\0"&&t[s+11]===1){const h=t[s+12]<<8|t[s+13];return console.log(`ä» JPEG è¯»å–åˆ° DPI: ${h}`),h}break}s++}}return null}catch(l){return console.warn("è¯»å–å›¾ç‰‡ DPI å¤±è´¥:",l),null}}async function re(a,l){return new Promise(async(t,s)=>{const c=new Image,n=new FileReader;let h=null;l.dpi==="original"&&(h=await Ae(a),console.log(`åŸå§‹æ–‡ä»¶ DPI: ${h||"æœªæ‰¾åˆ°"}`)),n.onload=r=>{var d;c.src=(d=r.target)==null?void 0:d.result},c.onload=async()=>{const r=document.createElement("canvas"),d=r.getContext("2d");if(!d){s(new Error("æ— æ³•åˆ›å»º Canvas ä¸Šä¸‹æ–‡"));return}const p=l.upscaleFactor,g=l.dpi==="original"?h||0:Number(l.dpi);r.width=Math.round(c.width*p),r.height=Math.round(c.height*p),d.imageSmoothingEnabled=!0,d.imageSmoothingQuality="high",d.drawImage(c,0,0,r.width,r.height);const x=d.getImageData(0,0,r.width,r.height),E=ze(x,l.denoiseLevel);d.putImageData(E,0,0),r.toBlob(async N=>{if(N)try{if(g===0)t({url:URL.createObjectURL(N),size:N.size});else{const y=await ce(N,g);t({url:URL.createObjectURL(y),size:y.size})}}catch(y){console.warn("æ·»åŠ  DPI å…ƒæ•°æ®å¤±è´¥ï¼Œä½¿ç”¨åŸå§‹å›¾ç‰‡",y),t({url:URL.createObjectURL(N),size:N.size})}else s(new Error("æ— æ³•ç”Ÿæˆå›¾ç‰‡"))},"image/png",.95)},c.onerror=()=>s(new Error("å›¾ç‰‡åŠ è½½å¤±è´¥")),n.readAsDataURL(a)})}async function ce(a,l){const t=await a.arrayBuffer(),s=new Uint8Array(t),c=[137,80,78,71,13,10,26,10];for(let p=0;p<c.length;p++)if(s[p]!==c[p])throw new Error("ä¸æ˜¯æœ‰æ•ˆçš„ PNG æ–‡ä»¶");const n=33,h=Math.round(l*39.3701),r=Re(h,h),d=new Uint8Array(s.length+r.length);return d.set(s.slice(0,n),0),d.set(r,n),d.set(s.slice(n),n+r.length),new Blob([d],{type:"image/png"})}function Re(a,l){const t=new Uint8Array(21),s=new DataView(t.buffer);s.setUint32(0,9,!1),t[4]=112,t[5]=72,t[6]=89,t[7]=115,s.setUint32(8,a,!1),s.setUint32(12,l,!1),t[16]=1;const c=Le(t.slice(4,17));return s.setUint32(17,c,!1),t}function Le(a){let l=4294967295;for(let t=0;t<a.length;t++){l^=a[t];for(let s=0;s<8;s++)l=l>>>1^3988292384&-(l&1)}return(l^4294967295)>>>0}function ze(a,l){const t=a.data,s=a.width,c=a.height;if(l==="none")return a;const n=l==="light"?1.15:l==="medium"?1.25:1.35,h=l==="light"?.3:l==="medium"?.5:.7,r=new Uint8ClampedArray(t.length);for(let d=0;d<t.length;d+=4){let p=t[d],g=t[d+1],x=t[d+2];p=Math.min(255,Math.max(0,(p-128)*n+128)),g=Math.min(255,Math.max(0,(g-128)*n+128)),x=Math.min(255,Math.max(0,(x-128)*n+128)),r[d]=p,r[d+1]=g,r[d+2]=x,r[d+3]=t[d+3]}for(let d=1;d<c-1;d++)for(let p=1;p<s-1;p++){const g=(d*s+p)*4;for(let x=0;x<3;x++){const E=r[g+x],N=r[((d-1)*s+p)*4+x]+r[((d+1)*s+p)*4+x]+r[(d*s+p-1)*4+x]+r[(d*s+p+1)*4+x],y=E+h*(E*4-N);t[g+x]=Math.min(255,Math.max(0,y))}}return a}async function Fe(a,l){return new Promise((t,s)=>{const c=new Image,n=new FileReader;n.onload=h=>{var r;c.src=(r=h.target)==null?void 0:r.result},c.onload=()=>{const h=document.createElement("canvas"),r=h.getContext("2d");if(!r){s(new Error("æ— æ³•åˆ›å»º Canvas ä¸Šä¸‹æ–‡"));return}h.width=c.width,h.height=c.height,r.drawImage(c,0,0);const d=r.getImageData(0,0,h.width,h.height),p=l.vectorizePrecision==="high"?128:l.vectorizePrecision==="medium"?150:180;me.trace(d,{threshold:p},(g,x)=>{if(g){s(g);return}const E=new Blob([x],{type:"image/svg+xml"});t(URL.createObjectURL(E))})},c.onerror=()=>s(new Error("å›¾ç‰‡åŠ è½½å¤±è´¥")),n.readAsDataURL(a)})}class Me{constructor(l){W(this,"queue",[]);W(this,"isProcessing",!1);W(this,"shouldStop",!1);this.callbacks=l}addImages(l){this.queue=[...l]}async start(){var l,t;if(this.isProcessing){console.warn("é˜Ÿåˆ—æ­£åœ¨å¤„ç†ä¸­");return}this.isProcessing=!0,this.shouldStop=!1;for(let s=0;s<this.queue.length&&!this.shouldStop;s++){const c=this.queue[s];try{this.callbacks.onImageStart(c.id);const n=await Ee(c,h=>{this.callbacks.onImageProgress(c.id,h)});this.callbacks.onImageComplete(c.id,n)}catch(n){const h=n instanceof Error?n.message:"æœªçŸ¥é”™è¯¯";console.error(`å¤„ç†å›¾ç‰‡ ${c.file.name} å¤±è´¥:`,n);const r=!!(n!=null&&n.userAborted),d=!!(n!=null&&n.skipImage);if(this.callbacks.onImageError(c.id,h,{userAborted:r,skip:d}),r){this.shouldStop=!0;break}}await new Promise(n=>setTimeout(n,100))}this.isProcessing=!1,this.shouldStop?(t=(l=this.callbacks).onQueueAborted)==null||t.call(l):this.callbacks.onQueueComplete()}stop(){this.shouldStop=!0,this.isProcessing=!1}}function Be(){const[a,l]=v.useState("upload"),[t,s]=v.useState([]),[c,n]=v.useState({total:0,completed:0,failed:0,currentIndex:0}),h=v.useRef(null),r=v.useRef(null),d=v.useCallback(async()=>{var m,U;if(r.current&&(clearTimeout(r.current),r.current=null),h.current)try{(U=(m=h.current).stop)==null||U.call(m)}catch(k){console.warn("åœæ­¢å¤„ç†é˜Ÿåˆ—å¤±è´¥",k)}t.forEach(k=>{var I,b;URL.revokeObjectURL(k.originalUrl),(I=k.result)!=null&&I.svgUrl&&URL.revokeObjectURL(k.result.svgUrl),(b=k.result)!=null&&b.pngUrl&&URL.revokeObjectURL(k.result.pngUrl)}),s([]),n({total:0,completed:0,failed:0,currentIndex:0}),l("upload");try{const{resetAIBackend:k}=await ie(async()=>{const{resetAIBackend:I}=await import("./aiUpscale-BFKUS1xm.js");return{resetAIBackend:I}},__vite__mapDeps([0,1,2]),import.meta.url);await k()}catch(k){console.warn("é‡ç½® AI åç«¯å¤±è´¥",k)}typeof window<"u"&&(window.location.href=window.location.href.replace(/#.*$/,""))},[t]),p=v.useCallback(m=>{const U={upscaleFactor:2,denoiseLevel:"none",outputFormat:"both",dpi:"original",enableBasicEnhancement:!0,enableAIUpscale:!1,enableVectorize:!1,vectorizePrecision:"medium"},k=m.map((I,b)=>({id:`img-${Date.now()}-${b}`,file:I,originalUrl:URL.createObjectURL(I),status:"pending",progress:0,options:{...U}}));s(I=>[...I,...k]),l("upload")},[]),g=v.useCallback((m,U)=>{s(k=>k.map(I=>I.id===m?{...I,options:{...I.options,...U}}:I))},[]),x=v.useCallback(m=>{s(U=>{var I,b;const k=U.find(R=>R.id===m);return k&&(URL.revokeObjectURL(k.originalUrl),(I=k.result)!=null&&I.svgUrl&&URL.revokeObjectURL(k.result.svgUrl),(b=k.result)!=null&&b.pngUrl&&URL.revokeObjectURL(k.result.pngUrl)),U.filter(R=>R.id!==m)})},[]),E=v.useCallback(()=>{if(t.length===0)return;l("processing"),n({total:t.length,completed:0,failed:0,currentIndex:0,startTime:Date.now()});const m={onImageStart:k=>{s(I=>I.map(b=>b.id===k?{...b,status:"processing",progress:0}:b))},onImageProgress:(k,I)=>{s(b=>b.map(R=>R.id===k?{...R,progress:Math.round(I)}:R))},onImageComplete:(k,I)=>{s(b=>b.map(R=>R.id===k?{...R,status:"completed",progress:100,result:I}:R)),n(b=>({...b,completed:b.completed+1,currentIndex:b.currentIndex+1}))},onImageError:(k,I,b)=>{s(R=>R.map(F=>F.id===k?{...F,status:"failed",error:I}:F)),n(R=>({...R,failed:R.failed+1,currentIndex:Math.min(R.currentIndex+1,t.length)})),b!=null&&b.userAborted?typeof window<"u"&&window.alert("å¤„ç†å·²åœæ­¢ï¼šç”¨æˆ·å–æ¶ˆäº† CPU æ¨¡å¼æ”¾å¤§ã€‚"):b!=null&&b.skip||typeof window<"u"&&window.alert(`å¤„ç†å¤±è´¥ï¼š${I}`)},onQueueComplete:()=>{l("results")},onQueueAborted:()=>{l("upload")}},U=new Me(m);h.current=U,U.addImages(t),U.start()},[t]),N=v.useCallback(()=>{d()},[d]),y=v.useCallback(()=>{l("results")},[]),D=v.useCallback(()=>{l("processing")},[]);return e.jsxs("div",{className:"app",children:[a==="upload"&&t.length===0&&e.jsx(xe,{}),e.jsxs("main",{className:"main-content",children:[a==="upload"&&e.jsx(e.Fragment,{children:t.length===0?e.jsx(je,{onFilesSelected:p}):e.jsx(Ue,{images:t,onUpdateOptions:g,onRemoveImage:x,onStartProcessing:E,onAddMore:p})}),a==="processing"&&e.jsx(Pe,{images:t,stats:c,onComplete:y}),a==="results"&&e.jsx(Ce,{images:t,onBackToUpload:N,onBackToProcessing:D})]}),e.jsx("footer",{className:"footer",children:e.jsx("div",{className:"footer-content",children:e.jsx("button",{className:"reset-button",onClick:d,children:"æ¸…é™¤ç¼“å­˜å¹¶åˆ·æ–°"})})})]})}he.createRoot(document.getElementById("root")).render(e.jsx(pe.StrictMode,{children:e.jsx(Be,{})}));
